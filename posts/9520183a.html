<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>mysql | Hexo</title><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="day61-mysql第1章 MySQL安装部署一 MySQL介绍1.MySQL和Mariadb的关系123MySQL被oracle收购了，由oracle内部在维护同一个作者在MySQL的基础又开发了Mariadb分支，由开源社区在维护 2.版本选择12https:&#x2F;&#x2F;downloads.mysql.com&#x2F;archives&#x2F;community&#x2F;  #官网链接社区免费版 二进制安装 5.7（主流）">
<meta property="og:type" content="article">
<meta property="og:title" content="mysql">
<meta property="og:url" content="http://example.com/posts/9520183a.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="day61-mysql第1章 MySQL安装部署一 MySQL介绍1.MySQL和Mariadb的关系123MySQL被oracle收购了，由oracle内部在维护同一个作者在MySQL的基础又开发了Mariadb分支，由开源社区在维护 2.版本选择12https:&#x2F;&#x2F;downloads.mysql.com&#x2F;archives&#x2F;community&#x2F;  #官网链接社区免费版 二进制安装 5.7（主流）">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-09-01T00:00:00.000Z">
<meta property="article:modified_time" content="2022-09-25T09:32:25.848Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/posts/9520183a"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'mysql',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-09-25 09:32:25'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://cdn.cbd.int/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Hexo</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">mysql</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-09-01T00:00:00.000Z" title="发表于 2021-09-01 00:00:00">2021-09-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-09-25T09:32:25.848Z" title="更新于 2022-09-25 09:32:25">2022-09-25</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="mysql"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="day61-mysql"><a href="#day61-mysql" class="headerlink" title="day61-mysql"></a>day61-mysql</h1><h2 id="第1章-MySQL安装部署"><a href="#第1章-MySQL安装部署" class="headerlink" title="第1章 MySQL安装部署"></a>第1章 MySQL安装部署</h2><h3 id="一-MySQL介绍"><a href="#一-MySQL介绍" class="headerlink" title="一 MySQL介绍"></a>一 MySQL介绍</h3><h4 id="1-MySQL和Mariadb的关系"><a href="#1-MySQL和Mariadb的关系" class="headerlink" title="1.MySQL和Mariadb的关系"></a>1.MySQL和Mariadb的关系</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MySQL被oracle收购了，由oracle内部在维护</span><br><span class="line">同一个作者在MySQL的基础又开发了Mariadb分支，由开源社区在维护</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="2-版本选择"><a href="#2-版本选择" class="headerlink" title="2.版本选择"></a>2.版本选择</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://downloads.mysql.com/archives/community/  #官网链接</span><br><span class="line">社区免费版 二进制安装 5.7（主流） 小版本最高</span><br></pre></td></tr></table></figure>
<p>2.1 关于版本选择和升级</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">版本升级:</span><br><span class="line">MySQL 4的时代已经过去了，除非是很古老的程序，现在一般都用MYSQL5了。</span><br><span class="line">MySQL 5.0与MySQL5.1相差不大，升级的话，直接卸载旧版本(备份数据库)，再安装新版本，然后把旧版本的DATA目录复制替换就行了。</span><br><span class="line">Mysql 5.5以上改变比较大，主要是默认存储引擎改为InnoDB，升级有点麻烦，而且很多程序对5.5以上版本支持不够好(原来是用MyISAM)。</span><br><span class="line"></span><br><span class="line">选择版本原则:</span><br><span class="line">小版本号越大越好，比如5.1版本目前最新最稳定的 MySQL 5.1.72。</span><br><span class="line">大版本号，比如5.5，5.6需要看程序是否支持。</span><br><span class="line">最新的大版本有 MySQL 8.0。</span><br><span class="line">主流使用5.7</span><br><span class="line">新版本可能会有性能及安全性的提升，但也会带来资源消耗的增加。并不一定是版本越新越好，关键是看程序是否支持和必要。</span><br></pre></td></tr></table></figure>
<p>2.2 版本介绍</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1，MySQL Community Server，社区免费版，但没有技术支持。一般我们选这个版本就行了。</span><br><span class="line">2，MySQL Enterprise 企业收费版。</span><br><span class="line">3，MySQL Cluster 这个主要是用于服务器集群。</span><br><span class="line">3，MySQL Workbench 这个用来设计数据库的。</span><br><span class="line"></span><br><span class="line">MYSQL有些版本号后面带有字母，比如mysql5.7.4 m14，mysql5.0.51a等等。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m版本：应该是MILESTONE的简写，里程碑的意思，说明这个版本有重要的功能升级。</span><br><span class="line">a版本：Available？稳定版？</span><br><span class="line">b版本：Beta缩写，是指公测，即针对所有用户公开的测试版本。</span><br><span class="line">alpha：内测版。</span><br><span class="line">rc版本：Release Candidate缩写，发行候选版本。和Beta版最大的差别在于Beta阶段会一直加入新的功能，而RC版本，着重于错误修复。</span><br></pre></td></tr></table></figure>
<p>2.3 企业生产场景版本选择MySQL数据库建设</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">分析本企业业务是否需要使用到MySQL的那些基本功能和特性，特性重点研究方向为：MySQL复制、分区表、Plugin-innodb等。</span><br><span class="line"></span><br><span class="line">MySQL数据库产品线第一个GA版本推出时间，至少要超过10个月，再考虑使用到生产环境中去。</span><br><span class="line"></span><br><span class="line">选择MySQL数据库GA版发布后6个月以上的GA版本</span><br><span class="line"></span><br><span class="line">选定的版本之后的一个版本，BUG修改量不大，严重BUG极少，并且不是最新的GA版本。</span><br><span class="line"></span><br><span class="line">对经过上述步骤挑选的GA版本，结合企业业务可能需要用的功能，都必须进行功能测试和性能测试，。</span><br><span class="line"></span><br><span class="line">要考虑开发人员开发程序使用的版本是否兼容你选的版本</span><br><span class="line"></span><br><span class="line">作为内部开发测试数据库环境，通常要试运行大概3-6个月的时间。</span><br><span class="line"></span><br><span class="line">企业非核心业务可以考虑采用新的GA版本。</span><br><span class="line"></span><br><span class="line">经过上述工序之后，若是没有重要的功能BUG或性能瓶颈，则可以开始考虑作为所有的业务数据服务的后端数据库。</span><br></pre></td></tr></table></figure>
<h3 id="二-MySQL安装部署"><a href="#二-MySQL安装部署" class="headerlink" title="二  MySQL安装部署"></a>二  MySQL安装部署</h3><h4 id="1-解压并创建软链接"><a href="#1-解压并创建软链接" class="headerlink" title="1.解压并创建软链接"></a>1.解压并创建软链接</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz -C /opt/</span><br><span class="line"><span class="built_in">cd</span> /opt/</span><br><span class="line"><span class="built_in">mv</span> mysql-5.7.28-linux-glibc2.12-x86_64 mysql-5.7.28</span><br><span class="line"><span class="built_in">ln</span> -s mysql-5.7.28 mysql</span><br><span class="line">ll</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="2-配置环境变量"><a href="#2-配置环境变量" class="headerlink" title="2.配置环境变量"></a>2.配置环境变量</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export PATH=$PATH:/opt/mysql/bin&#x27;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">mysql -V</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="3-清理历史遗留环境"><a href="#3-清理历史遗留环境" class="headerlink" title="3.清理历史遗留环境"></a>3.清理历史遗留环境</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa|grep mariadb</span><br><span class="line">yum remove mariadb-libs -y</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/my.cnf</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="4-安装mysql依赖包"><a href="#4-安装mysql依赖包" class="headerlink" title="4.安装mysql依赖包"></a>4.安装mysql依赖包</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y libaio-devel</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="5-创建mysql普通用户并授权"><a href="#5-创建mysql普通用户并授权" class="headerlink" title="5.创建mysql普通用户并授权"></a>5.创建mysql普通用户并授权</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">groupadd -g 2000 mysql</span><br><span class="line">useradd -u 2000 -g 2000 -s /sbin/nologin -M mysql</span><br><span class="line"><span class="built_in">mkdir</span> -p /data/mysql_3306/</span><br><span class="line"><span class="built_in">chown</span> -R mysql.mysql /data/</span><br><span class="line"><span class="built_in">chown</span> -R mysql.mysql /opt/mysql*</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="6-初始化数据库data目录"><a href="#6-初始化数据库data目录" class="headerlink" title="6.初始化数据库data目录"></a>6.初始化数据库data目录</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysqld --initialize-insecure --user=mysql --basedir=/opt/mysql --datadir=/data/mysql_3306/</span><br><span class="line">目录需要为空</span><br></pre></td></tr></table></figure>
<h4 id="7-编辑mysql配置文件"><a href="#7-编辑mysql配置文件" class="headerlink" title="7.编辑mysql配置文件"></a>7.编辑mysql配置文件</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span>&gt; /etc/my.cnf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string">user=mysql</span></span><br><span class="line"><span class="string">basedir=/opt/mysql</span></span><br><span class="line"><span class="string">datadir=/data/mysql_3306</span></span><br><span class="line"><span class="string">socket=/tmp/mysql_3306.sock</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysql]</span></span><br><span class="line"><span class="string">socket=/tmp/mysql_3306.sock</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="8-准备启动systemd脚本并启动数据库"><a href="#8-准备启动systemd脚本并启动数据库" class="headerlink" title="8.准备启动systemd脚本并启动数据库"></a>8.准备启动systemd脚本并启动数据库</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/systemd/system/mysqldd.service &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=MySQL Server</span></span><br><span class="line"><span class="string">Documentation=man:mysqld(8)</span></span><br><span class="line"><span class="string">Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string">After=syslog.target</span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">User=mysql</span></span><br><span class="line"><span class="string">Group=mysql</span></span><br><span class="line"><span class="string">ExecStart=/opt/mysql/bin/mysqld --defaults-file=/opt/my.cnf</span></span><br><span class="line"><span class="string">LimitNOFILE = 5000</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /opt/mysql/support-files/mysql.server  /etc/init.d/mysqld</span><br><span class="line">chkconfig --add mysqld</span><br><span class="line">systemctl start mysqld</span><br><span class="line">netstat -lntup|grep 3306</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="9-登录测试"><a href="#9-登录测试" class="headerlink" title="9.登录测试"></a>9.登录测试</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br></pre></td></tr></table></figure>
<h3 id="三-MySQL启动和关闭管理"><a href="#三-MySQL启动和关闭管理" class="headerlink" title="三  MySQL启动和关闭管理"></a>三  MySQL启动和关闭管理</h3><h4 id="1-MySQL启动的方式"><a href="#1-MySQL启动的方式" class="headerlink" title="1.MySQL启动的方式"></a>1.MySQL启动的方式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysqld_safe --defaults-file=/etc/my.cnf</span><br><span class="line">-- systemctl start mysqld</span><br><span class="line">-- service mysqld restart</span><br><span class="line">-- /etc/inint.d/mysqld restart</span><br><span class="line"></span><br><span class="line">mysqld --defaults-file=/etc/my.cnf</span><br><span class="line"></span><br><span class="line">调试启动:</span><br><span class="line">如果作为调试可以直接使用命令启动，这是会作为前台启动将日志都打印到屏幕上</span><br><span class="line">mysqld</span><br><span class="line">mysqld_safe</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="2-错误日志"><a href="#2-错误日志" class="headerlink" title="2.错误日志"></a>2.错误日志</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">默认如果没有额外指定,那么报错日志在数据目录下以主机名命名的文件</span><br><span class="line">/data/mysql_3306/db-51.err</span><br></pre></td></tr></table></figure>
<h4 id="3-关闭方式"><a href="#3-关闭方式" class="headerlink" title="3.关闭方式"></a>3.关闭方式</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">service mysqld stop</span><br><span class="line">systemctl stop mysqld</span><br><span class="line"><span class="built_in">kill</span> $(<span class="built_in">cat</span> /data/mysql_3306/db-51.pid)</span><br><span class="line">pkill mysqld</span><br><span class="line">mysql -uroot -p123456 -e <span class="string">&#x27;shutdown;&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="四-用户管理"><a href="#四-用户管理" class="headerlink" title="四  用户管理"></a>四  用户管理</h3><h4 id="1-MySQL用户定义"><a href="#1-MySQL用户定义" class="headerlink" title="1.MySQL用户定义"></a>1.MySQL用户定义</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Linux:</span><br><span class="line">账号+密码</span><br><span class="line"></span><br><span class="line">MySQL:</span><br><span class="line">可登录主机+账号+密码</span><br><span class="line"></span><br><span class="line">举例：</span><br><span class="line">地址列表，允许白名单的IP登录MySQL，管理MySQL。</span><br><span class="line">oldya@<span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">oldya@<span class="string">&#x27;10.0.0.10&#x27;</span></span><br><span class="line">oldya@<span class="string">&#x27;10.0.0.%&#x27;</span> </span><br><span class="line">oldya@<span class="string">&#x27;%&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="2-查看用户"><a href="#2-查看用户" class="headerlink" title="2.查看用户"></a>2.查看用户</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查询   字段1,字段2    从      库.表</span><br><span class="line">select user,host   from  mysql.user;</span><br></pre></td></tr></table></figure>
<h4 id="3-创建用户"><a href="#3-创建用户" class="headerlink" title="3.创建用户"></a>3.创建用户</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">create user oldboy@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">create user oldboy@<span class="string">&#x27;10.0.0.7&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">create user oldboy@<span class="string">&#x27;10.0.0.%&#x27;</span> identified by <span class="string">&#x27;1234&#x27;</span>;</span><br><span class="line"></span><br><span class="line">实验结果:</span><br><span class="line">+---------------+-----------+</span><br><span class="line">| user          | host      |</span><br><span class="line">+---------------+-----------+</span><br><span class="line">| oldboy        | %         |  172.16.1.51</span><br><span class="line">| oldboy        | 10.0.0.%  |  web-8</span><br><span class="line">| oldboy        | 10.0.0.7  |  web-7</span><br><span class="line"></span><br><span class="line">结论就是:</span><br><span class="line">根据主机匹配</span><br><span class="line">连接MySQL的时候那个账号匹配的最精确,就用哪个规则</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">创建用户并赋予所有主机所有权限</span><br><span class="line">grant all privileges on *.* to <span class="string">&#x27;all&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="4-修改用户密码"><a href="#4-修改用户密码" class="headerlink" title="4.修改用户密码"></a>4.修改用户密码</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root修改别人: 不需要知道他的密码</span><br><span class="line">select user,host from  mysql.user;</span><br><span class="line">alter user oldboy@<span class="string">&#x27;10.0.0.7&#x27;</span> identified by <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line">普通账号修改自己: 知道自己的密码</span><br><span class="line">1)推荐</span><br><span class="line"><span class="built_in">set</span> password=password(<span class="string">&#x27;123&#x27;</span>);</span><br><span class="line"></span><br><span class="line">2)繁琐</span><br><span class="line">alter user oldboy@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line"></span><br><span class="line">3）危险不推荐</span><br><span class="line">mysqladmin -uroot -p123 password <span class="string">&#x27;456&#x27;</span></span><br><span class="line">mysqladmin -uroot -p123 password <span class="string">&#x27;456&#x27;</span> -S /tmp/mysql_3306.sock</span><br></pre></td></tr></table></figure>
<h4 id="5-删除用户"><a href="#5-删除用户" class="headerlink" title="5.删除用户"></a>5.删除用户</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop user oldboy@&#x27;%&#x27;;</span><br></pre></td></tr></table></figure>
<h4 id="6-设置密码"><a href="#6-设置密码" class="headerlink" title="6.设置密码"></a>6.设置密码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">刚初始化完设置密码:</span><br><span class="line">mysqladmin password -S /tmp/mysql_3306.sock</span><br></pre></td></tr></table></figure>
<h4 id="7-找回root密码"><a href="#7-找回root密码" class="headerlink" title="7.找回root密码"></a>7.找回root密码</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop mysql</span><br><span class="line">#忽略授权登录验证</span><br><span class="line">mysqld_safe --skip-grant-tables --user=mysql</span><br><span class="line">systemctl start mysql</span><br><span class="line"></span><br><span class="line">#免密登录</span><br><span class="line">mysql</span><br><span class="line">#修改密码</span><br><span class="line">UPDATE mysql.user SET authentication_string=PASSWORD(&quot;123456&quot;) WHERE</span><br><span class="line">user=&#x27;root&#x27; and host=&#x27;localhost&#x27;;</span><br><span class="line">exit;</span><br><span class="line"></span><br><span class="line">systemctl restart mysqld</span><br><span class="line">mysql -uroot -p123456</span><br><span class="line">#忽略授权登录验证，改完密码后马上改回来</span><br><span class="line">使用跳过授权表之后,所有的本地和远程用户都不需要用户名密码认证即可连接,非常危险.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="五-登录连接管理"><a href="#五-登录连接管理" class="headerlink" title="五 登录连接管理"></a>五 登录连接管理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MySQL的登录连接方式：</span><br><span class="line">远程连接: IP+端口</span><br><span class="line">本地连接: socket文件</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">只要不加-h就是本地socket连接</span><br><span class="line">mysql -uroot -p123 --&gt; /etc/my.cnf --&gt; [mysql] --&gt; /tmp/mysql_3306.sock</span><br><span class="line">mysql -uroot -p123 --&gt; /etc/my.cnf --&gt; /tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">解决:</span><br><span class="line">mysql -h127.0.0.1 -uroot -p123</span><br><span class="line">mysql -uroot -p123 -S /tmp/mysql_3306.sock</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="六-配置管理"><a href="#六-配置管理" class="headerlink" title="六 配置管理"></a>六 配置管理</h3><h4 id="1-配置文件说明"><a href="#1-配置文件说明" class="headerlink" title="1.配置文件说明"></a>1.配置文件说明</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[mysqld] <span class="comment"># 服务端标签</span></span><br><span class="line">user=mysql <span class="comment"># MySQL内置管理用户</span></span><br><span class="line">basedir=/data/app/mysql <span class="comment"># 软件目录</span></span><br><span class="line">datadir=/data/3306/data <span class="comment"># 数据目录</span></span><br><span class="line">socket=/tmp/mysql.sock <span class="comment"># socket文件生成目录</span></span><br><span class="line">port=3306 <span class="comment"># 端口号</span></span><br><span class="line">server_id <span class="comment"># 主机编号（主从使用）</span></span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">socket=/tmp/mysql.sock <span class="comment"># mysql 连接数据库自动读取的socket位置</span></span><br><span class="line"></span><br><span class="line">[标签项]</span><br><span class="line">服务端标签：</span><br><span class="line">[server] 所有服务端的程序</span><br><span class="line">[mysqld] mysqld 程序运行时读取的配置</span><br><span class="line">[mysqld_safe] mysqld_safe 程序运行时读取的配置</span><br><span class="line"></span><br><span class="line">客户端标签：</span><br><span class="line">[clinet] 所有本地客户端的程序</span><br><span class="line">[mysql] mysql命令在本地执行时读取的配置</span><br><span class="line">[mysqldump] mysqldump .....................</span><br></pre></td></tr></table></figure>
<h4 id="2-配置优先级"><a href="#2-配置优先级" class="headerlink" title="2.配置优先级"></a>2.配置优先级</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">命令行 &gt; 配置文件 &gt; 编译</span><br><span class="line">例如： port</span><br><span class="line">配置文件： port=3306 2</span><br><span class="line">命令行： port=3307 1</span><br><span class="line">源码编译： port=3308 3</span><br></pre></td></tr></table></figure>
<h4 id="3-配置文件优先级"><a href="#3-配置文件优先级" class="headerlink" title="3.配置文件优先级"></a>3.配置文件优先级</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysqld --<span class="built_in">help</span> --verbose  |grep my.cnf</span><br><span class="line">/etc/my.cnf </span><br><span class="line">/etc/mysql/my.cnf </span><br><span class="line">/usr/local/mysql/etc/my.cnf </span><br><span class="line">~/.my.cnf</span><br><span class="line"></span><br><span class="line">会以最后一个配置文件为准</span><br></pre></td></tr></table></figure>
<h4 id="4-优先级实验"><a href="#4-优先级实验" class="headerlink" title="4.优先级实验"></a>4.优先级实验</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">3306 /etc/my.cnf                     </span><br><span class="line">3307 /etc/mysql/my.cnf </span><br><span class="line">3308 /usr/local/mysql/etc/my.cnf </span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/mysql/my.cnf &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[mysqld]</span><br><span class="line">port=3307</span><br><span class="line">user=mysql</span><br><span class="line">basedir=/opt/mysql</span><br><span class="line">datadir=/data/mysql_3306</span><br><span class="line">socket=/tmp/mysql_3306.sock</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">socket=/tmp/mysql_3306.sock</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; /usr/local/mysql/etc/my.cnf  &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[mysqld]</span><br><span class="line">port=3308</span><br><span class="line">user=mysql</span><br><span class="line">basedir=/opt/mysql</span><br><span class="line">datadir=/data/mysql_3306</span><br><span class="line">socket=/tmp/mysql_3306.sock</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">socket=/tmp/mysql_3306.sock</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt; ~/.my.cnf &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[mysqld]</span><br><span class="line">port=3309</span><br><span class="line">user=mysql</span><br><span class="line">basedir=/opt/mysql</span><br><span class="line">datadir=/data/mysql_3306</span><br><span class="line">socket=/tmp/mysql_3306.sock</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">socket=/tmp/mysql_3306.sock</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">优先级:</span><br><span class="line">1.命令直接接参数</span><br><span class="line">2./etc/my.cnf</span><br><span class="line">3./etc/mysql/my.cnf</span><br><span class="line">4./usr/local/mysql/etc/my.cnf</span><br><span class="line"></span><br><span class="line">结论:</span><br><span class="line">如果有多个配置文件,并且参数不同</span><br><span class="line">那么优先级低的会覆盖优先级高的,也就是以最后读的文件为准</span><br><span class="line"></span><br><span class="line">调试技巧:</span><br><span class="line">mysqld --defaults-file=/etc/my.cnf --port=3333</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="七-多实例MySQL"><a href="#七-多实例MySQL" class="headerlink" title="七 多实例MySQL"></a>七 多实例MySQL</h3><h4 id="1-什么叫多实例MySQL"><a href="#1-什么叫多实例MySQL" class="headerlink" title="1.什么叫多实例MySQL"></a>1.什么叫多实例MySQL</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql多实例，简单理解就是在一台服务器上，<span class="string">&#x27;mysql服务开启多个不同的端口(如3306、3307)，运行多个服务进程&#x27;</span>。</span><br><span class="line"></span><br><span class="line">在同一台云服务器上，mysql 多实例会去共用一套 mysql 应用程序，因此你在部署 mysql 的时候只需要部署一次 mysql程序即可，无需多次部署。但是，<span class="string">&#x27;mysql多实例之间会各自使用不同的 my.cnf 配置文件、启动程序和数据文件&#x27;</span>。在提供服务方面，mysql多实例在逻辑上看起来是各自独立，互不干涉的，并且多个实例之间是根据配置文件的设定值，来获取相关云服务器的硬件资源。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="2-创建多实例MySQL进程"><a href="#2-创建多实例MySQL进程" class="headerlink" title="2.创建多实例MySQL进程"></a>2.创建多实例MySQL进程</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">1.创建数据目录并更改授权</span><br><span class="line"><span class="built_in">mkdir</span> -p /data/mysql_3307/</span><br><span class="line"><span class="built_in">mkdir</span> -p /data/mysql_3308/</span><br><span class="line"><span class="built_in">chown</span> -R mysql.mysql /data/</span><br><span class="line"></span><br><span class="line">2.初始化数据库</span><br><span class="line">mysqld --initialize-insecure --user=mysql --basedir=/opt/mysql --datadir=/data/mysql_3307/</span><br><span class="line">mysqld --initialize-insecure --user=mysql --basedir=/opt/mysql --datadir=/data/mysql_3308/</span><br><span class="line"></span><br><span class="line">3.创建配置文件</span><br><span class="line"><span class="built_in">cat</span>&gt; /etc/my_3307.cnf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string">port=3307</span></span><br><span class="line"><span class="string">user=mysql</span></span><br><span class="line"><span class="string">basedir=/opt/mysql</span></span><br><span class="line"><span class="string">datadir=/data/mysql_3307</span></span><br><span class="line"><span class="string">socket=/tmp/mysql_3307.sock</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysql]</span></span><br><span class="line"><span class="string">socket=/tmp/mysql_3307.sock</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span>&gt; /etc/my_3308.cnf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string">port=3308</span></span><br><span class="line"><span class="string">user=mysql</span></span><br><span class="line"><span class="string">basedir=/opt/mysql</span></span><br><span class="line"><span class="string">datadir=/data/mysql_3308</span></span><br><span class="line"><span class="string">socket=/tmp/mysql_3308.sock</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysql]</span></span><br><span class="line"><span class="string">socket=/tmp/mysql_3308.sock</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">4.修改启动脚本</span><br><span class="line"><span class="built_in">cat</span> &gt;/etc/systemd/system/mysqld_3307.service &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=MySQL Server</span></span><br><span class="line"><span class="string">Documentation=man:mysqld(8)</span></span><br><span class="line"><span class="string">Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string">After=syslog.target</span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">User=mysql</span></span><br><span class="line"><span class="string">Group=mysql</span></span><br><span class="line"><span class="string">ExecStart=/opt/mysql/bin/mysqld --defaults-file=/etc/my_3307.cnf</span></span><br><span class="line"><span class="string">LimitNOFILE = 5000</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cat</span> &gt;/etc/systemd/system/mysqld_3308.service &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[Unit]</span></span><br><span class="line"><span class="string">Description=MySQL Server</span></span><br><span class="line"><span class="string">Documentation=man:mysqld(8)</span></span><br><span class="line"><span class="string">Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"><span class="string">After=syslog.target</span></span><br><span class="line"><span class="string">[Install]</span></span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br><span class="line"><span class="string">[Service]</span></span><br><span class="line"><span class="string">User=mysql</span></span><br><span class="line"><span class="string">Group=mysql</span></span><br><span class="line"><span class="string">ExecStart=/opt/mysql/bin/mysqld_safe --defaults-file=/etc/my_3308.cnf</span></span><br><span class="line"><span class="string">LimitNOFILE = 5000</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line">5.启动多实例</span><br><span class="line">systemctl daemon-reload </span><br><span class="line">systemctl start mysqld_3307.service</span><br><span class="line">systemctl start mysqld_3308.service</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="第2章-mysql-SQL语句"><a href="#第2章-mysql-SQL语句" class="headerlink" title="第2章 mysql-SQL语句"></a>第2章 mysql-SQL语句</h2><h3 id="一-sql介绍"><a href="#一-sql介绍" class="headerlink" title="一 sql介绍"></a>一 sql介绍</h3><h4 id="1-什么叫SQL语句"><a href="#1-什么叫SQL语句" class="headerlink" title="1.什么叫SQL语句?"></a>1.什么叫SQL语句?</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SQL 是 Structured Query Language 的缩写，中文译为“结构化查询语言”。SQL 是一种计算机语言，用来存储、检索和修改关系型数据库中存储的数据。</span><br><span class="line"></span><br><span class="line">SQL 是关系型数据库的标准语言，所有的关系型数据库管理系统（RDBMS），比如 MySQL、Oracle、SQL Server、MS Access、Sybase、Informix、Postgres 等，都将 SQL 作为其标准处理语言。</span><br></pre></td></tr></table></figure>
<h4 id="2-SQL的分类-DDL、DCL、DML、DQL"><a href="#2-SQL的分类-DDL、DCL、DML、DQL" class="headerlink" title="2.SQL的分类-DDL、DCL、DML、DQL"></a>2.SQL的分类-DDL、DCL、DML、DQL</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">DDL ： 数据定义语⾔</span><br><span class="line">对于： 库 、表（元数据）的 增、删、改</span><br><span class="line">建库、删库、修改库、建表、删表、修改表</span><br><span class="line"></span><br><span class="line">DCL ： 数据控制语⾔</span><br><span class="line">grant</span><br><span class="line">revoke</span><br><span class="line"></span><br><span class="line">DML ： 数据操作语⾔</span><br><span class="line">表的数据⾏进⾏的增、删、改、查</span><br><span class="line"></span><br><span class="line">DQL ： 数据查询语⾔</span><br><span class="line">对于表数据⾏查看</span><br><span class="line">对于元数据查看</span><br></pre></td></tr></table></figure>
<h3 id="二-数据库对象属性介绍"><a href="#二-数据库对象属性介绍" class="headerlink" title="二 数据库对象属性介绍"></a>二 数据库对象属性介绍</h3><h4 id="1-字符集"><a href="#1-字符集" class="headerlink" title="1.字符集"></a>1.字符集</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>utf8    最⼤⽀持<span class="number">3</span>字节的字符。不⽀持emoji字符</span><br><span class="line"><span class="number">2.</span>utf8mb4 最⼤⽀持<span class="number">4</span>字节的字符。⽀持emoji字符</span><br></pre></td></tr></table></figure>
<p>修改库客户端默认字符集</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%char%&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> NAMES utf8mb4;</span><br></pre></td></tr></table></figure>
<p>修改配置⽂件添加默认字符集参数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="operator">/</span>etc<span class="operator">/</span>my.cnf </span><br><span class="line">[mysqld]</span><br><span class="line">character_set_server<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure>
<h4 id="2-列属性"><a href="#2-列属性" class="headerlink" title="2.列属性"></a>2.列属性</h4><h5 id="2-1-数字类型"><a href="#2-1-数字类型" class="headerlink" title="2.1 数字类型"></a>2.1 数字类型</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">整数：</span><br><span class="line"> tinyint    1字节 = 8位 = 00000000 - 11111111 = 2^8个 = 0 - 255 , -127-128 </span><br><span class="line"> int        4字节 = 32位 = 2^32个 = 0 - 2^32-1 ,-2^31-2^31-</span><br><span class="line"> 1 ,10位数   </span><br><span class="line"> bigint     8字节 0 - 2^64-1 ,-2^63-2^63-</span><br><span class="line"> 1 ,20位数</span><br><span class="line"> </span><br><span class="line">浮点数：</span><br><span class="line"> decimal(m,n)</span><br></pre></td></tr></table></figure>
<h5 id="2-2-字段类型"><a href="#2-2-字段类型" class="headerlink" title="2.2 字段类型"></a>2.2 字段类型</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">char(N) :</span><br><span class="line"> N字符个数，最⼤不超过255</span><br><span class="line"> 定⻓的字符串类型。</span><br><span class="line"> 例如： char(10) ,最多存10个字符,只要10个字符以内，都10个字符⻓度的存储空间。剩余⽤空格填充。</span><br><span class="line"> </span><br><span class="line">varchar(M) ：</span><br><span class="line"> M字符个数，最⼤不超过65535</span><br><span class="line"> 变⻓的字符串类型。会额外占⽤1-2字节存储字符⻓度。255字符之内，额外1字节，255以上，额外2字节</span><br><span class="line"> 例如： varchar(10),最多存10个字符,按需分配存储空间。</span><br><span class="line"> abc 3 =4</span><br><span class="line"> asdasdadasd 1000 =1002</span><br><span class="line"> </span><br><span class="line">enum(<span class="string">&#x27;bj&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;tj&#x27;</span>,<span class="string">&#x27;heibei&#x27;</span>,<span class="string">&#x27;henan&#x27;</span>,.....)</span><br><span class="line">district enum(<span class="string">&#x27;bj&#x27;</span>,<span class="string">&#x27;sh&#x27;</span>,<span class="string">&#x27;tj&#x27;</span>,<span class="string">&#x27;heibei&#x27;</span>,<span class="string">&#x27;henan&#x27;</span>,.....)</span><br></pre></td></tr></table></figure>
<h5 id="2-3-时间类型"><a href="#2-3-时间类型" class="headerlink" title="2.3 时间类型"></a>2.3 时间类型</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DATETIME</span><br><span class="line">8字节</span><br><span class="line">范围为从 1000-01-01 00:00:00.000000 ⾄ 9999-12-31 23:59:59.999999。</span><br><span class="line"></span><br><span class="line">TIMESTAMP</span><br><span class="line">4字节</span><br><span class="line">1970-01-01 00:00:00.000000 ⾄ 2038-01-19 03:14:07.999999。</span><br><span class="line">timestamp会受到时区的影响</span><br></pre></td></tr></table></figure>
<h4 id="3-列约束"><a href="#3-列约束" class="headerlink" title="3.列约束"></a>3.列约束</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">主键 primary key （PK）</span><br><span class="line">1.⼀张表只能有⼀个，可以有多个列构成</span><br><span class="line">2.特点： ⾮空+唯⼀</span><br><span class="line">3.建议每张表都设置主键，有利于索引的应⽤，通常是使⽤⾃增的数字列更佳。</span><br><span class="line"></span><br><span class="line">⾮空 not null</span><br><span class="line">1.特点： 必须录⼊值。</span><br><span class="line">2.建议： 每个列最好设置为，有利于索引的应⽤。</span><br><span class="line"></span><br><span class="line">唯⼀ unique key</span><br><span class="line">1.特点： 不能有重复值。</span><br><span class="line"></span><br><span class="line">⽆符号 unsigned</span><br><span class="line">1.特点： 针对数字列，⽆符号设定。</span><br></pre></td></tr></table></figure>
<h4 id="4-其他属性"><a href="#4-其他属性" class="headerlink" title="4.其他属性"></a>4.其他属性</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">表属性 ：</span><br><span class="line"> engine ：        存储引擎设置，默认是innodb，也是我们建议的。</span><br><span class="line"> charset ：       utf8mb4</span><br><span class="line"> comment ：       注释。</span><br><span class="line"> </span><br><span class="line">列属性 ：</span><br><span class="line"> default ： 默认值。⼀般是在not null 配合使⽤</span><br><span class="line"> auto_increment： 数字列⾃增⻓。⼀般是在主键列配合使⽤</span><br><span class="line"> comment ： 列的注释，建议每个列都有</span><br></pre></td></tr></table></figure>
<h4 id="3-去公司如何熟悉数据库业务"><a href="#3-去公司如何熟悉数据库业务" class="headerlink" title="3. 去公司如何熟悉数据库业务?"></a>3. 去公司如何熟悉数据库业务?</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>第一步: 先看表的名字</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> tables <span class="keyword">from</span> world;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+</span></span><br><span class="line"><span class="operator">|</span> Tables_in_world <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+</span></span><br><span class="line"><span class="operator">|</span> city            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> country         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> countrylanguage <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>第二步: 看表结构</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> city;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+----------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> Field       <span class="operator">|</span> Type     <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+----------+------+-----+---------+----------------+</span></span><br><span class="line"><span class="operator">|</span> ID          <span class="operator">|</span> <span class="type">int</span>(<span class="number">11</span>)  <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span> auto_increment <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Name        <span class="operator">|</span> <span class="type">char</span>(<span class="number">35</span>) <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span>         <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> CountryCode <span class="operator">|</span> <span class="type">char</span>(<span class="number">3</span>)  <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> MUL <span class="operator">|</span>         <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> District    <span class="operator">|</span> <span class="type">char</span>(<span class="number">20</span>) <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span>         <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Population  <span class="operator">|</span> <span class="type">int</span>(<span class="number">11</span>)  <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="number">0</span>       <span class="operator">|</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------+----------+------+-----+---------+----------------+</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>第三步: 理解字段的含义</span><br><span class="line">ID         		序号</span><br><span class="line">Name            城市名称</span><br><span class="line">CountryCode     国家代码</span><br><span class="line">District        省会</span><br><span class="line">Population      人口</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>第四步: 少量的查看一部分数据</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> city limit <span class="number">5</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------------+-------------+---------------+------------+</span></span><br><span class="line"><span class="operator">|</span> ID <span class="operator">|</span> Name           <span class="operator">|</span> CountryCode <span class="operator">|</span> District      <span class="operator">|</span> Population <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------------+-------------+---------------+------------+</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">1</span> <span class="operator">|</span> Kabul          <span class="operator">|</span> AFG         <span class="operator">|</span> Kabol         <span class="operator">|</span>    <span class="number">1780000</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">2</span> <span class="operator">|</span> Qandahar       <span class="operator">|</span> AFG         <span class="operator">|</span> Qandahar      <span class="operator">|</span>     <span class="number">237500</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">3</span> <span class="operator">|</span> Herat          <span class="operator">|</span> AFG         <span class="operator">|</span> Herat         <span class="operator">|</span>     <span class="number">186800</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">4</span> <span class="operator">|</span> Mazar<span class="operator">-</span>e<span class="operator">-</span>Sharif <span class="operator">|</span> AFG         <span class="operator">|</span> Balkh         <span class="operator">|</span>     <span class="number">127800</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span>  <span class="number">5</span> <span class="operator">|</span> Amsterdam      <span class="operator">|</span> NLD         <span class="operator">|</span> Noord<span class="operator">-</span>Holland <span class="operator">|</span>     <span class="number">731200</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------------+-------------+---------------+------------+</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="三-DDL数据库定义语⾔"><a href="#三-DDL数据库定义语⾔" class="headerlink" title="三 DDL数据库定义语⾔"></a>三 DDL数据库定义语⾔</h3><h4 id="1-库定义"><a href="#1-库定义" class="headerlink" title="1.库定义"></a>1.库定义</h4><h5 id="1-1-建表语句"><a href="#1-1-建表语句" class="headerlink" title="1.1 建表语句"></a>1.1 建表语句</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">库名不能数字开头</span><br><span class="line"></span><br><span class="line">库名不要有⼤写字符，原因：为了多平台兼容。</span><br><span class="line"></span><br><span class="line">⽣产中禁⽤普通⽤户的drop database权限。</span><br><span class="line"></span><br><span class="line">库名要和业务有关</span><br><span class="line"></span><br><span class="line">建库需要显示指定字符集。建议是utf8mb4。 </span><br></pre></td></tr></table></figure>
<h6 id="1-2-创建库"><a href="#1-2-创建库" class="headerlink" title="1.2 创建库"></a>1.2 创建库</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE oldya CHARSET utf8mb4;</span><br><span class="line">CREATE DATABASE oldboy;</span><br></pre></td></tr></table></figure>
<h6 id="1-3-修改库"><a href="#1-3-修改库" class="headerlink" title="1.3 修改库"></a>1.3 修改库</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE oldya;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE oldboy;</span><br><span class="line"><span class="keyword">ALTER</span> DATABASE oldya CHARSET utf8mb4;</span><br></pre></td></tr></table></figure>
<h6 id="1-4-查看库"><a href="#1-4-查看库" class="headerlink" title="1.4 查看库"></a>1.4 查看库</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> databases;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> DATABASE oldboy;</span><br></pre></td></tr></table></figure>
<h6 id="1-5-删除库"><a href="#1-5-删除库" class="headerlink" title="1.5 删除库"></a>1.5 删除库</h6><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>删数据</span><br><span class="line">注意<span class="operator">!</span><span class="operator">!</span><span class="operator">!</span>删除表数据一定要加上限定条件<span class="operator">!</span><span class="operator">!</span><span class="operator">!</span>注意</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> `school`.`linux7` <span class="keyword">WHERE</span> `id` <span class="operator">=</span> <span class="string">&#x27;29&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>伪删除</span><br><span class="line">第一步: 增加一个状态字段</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `school`.`linux7` <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> `status` </span><br><span class="line">ENUM(<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;0&#x27;</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;删除状态,0删除,1存在&#x27;</span> </span><br><span class="line">AFTER `address`; </span><br><span class="line"></span><br><span class="line">第二步: 改造业务的查询语句</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> linux7 <span class="keyword">WHERE</span> STATUS <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"></span><br><span class="line">第三步: 改造业务的删除逻辑<span class="operator">-</span>将删除替换为更新</span><br><span class="line"><span class="keyword">UPDATE</span> `school`.`linux7` <span class="keyword">SET</span> `status` <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">WHERE</span> `id` <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>删字段<span class="operator">-</span>不要会</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `school`.`linux7` <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> `status`; </span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>删表<span class="operator">-</span>不要会</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> `school`.`linux7`; </span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>删库<span class="operator">-</span>没教过</span><br><span class="line"><span class="keyword">DROP</span> DATABASE `school`;</span><br></pre></td></tr></table></figure>
<h4 id="2-表定义"><a href="#2-表定义" class="headerlink" title="2.表定义"></a>2.表定义</h4><h5 id="2-1-表定义规范"><a href="#2-1-表定义规范" class="headerlink" title="2.1 表定义规范"></a>2.1 表定义规范</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 建表 </span><br><span class="line"> a. 表名：</span><br><span class="line">        不能数字开头</span><br><span class="line">        业务有关</span><br><span class="line">        不要⼤写字⺟</span><br><span class="line">        不要超过<span class="number">18</span>字符</span><br><span class="line">        不能是关键字</span><br><span class="line"> b. 存储引擎使⽤InnoDB</span><br><span class="line"> c. 字符集使⽤utf8mb4</span><br><span class="line"> d. 列名要和业务有关，不要超过<span class="number">18</span>个字符</span><br><span class="line"> e. 选择合适、简短数据类型</span><br><span class="line"> f. 建议每个列设置<span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line"> g. 针对<span class="keyword">not</span> <span class="keyword">null</span> 列，可以设定默认值。</span><br><span class="line"> h. 每个列要有注释</span><br><span class="line"> i. 每个表要有主键</span><br><span class="line"> j. 表注释</span><br><span class="line"> </span><br><span class="line"><span class="number">2.</span> 修改表</span><br><span class="line"> a. 添加列，使⽤追加式添加列</span><br><span class="line"> b. 修改列属性，尽量使⽤modify语句</span><br><span class="line"> c. 修改表定义，建议在业务不繁忙期间进⾏。尽量采⽤pt<span class="operator">-</span>osc或者gh<span class="operator">-</span>ost⼯具减少业务影响</span><br></pre></td></tr></table></figure>
<p>推荐软件:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yearing 开源SQL审核⼯具。</span><br><span class="line">inception SQL审核⼯具。</span><br></pre></td></tr></table></figure>
<h5 id="2-2-创建表"><a href="#2-2-创建表" class="headerlink" title="2.2 创建表"></a>2.2 创建表</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">什么是主键：</span><br><span class="line">        主键（PRIMARY KEY）”的完整称呼是“主键约束”。</span><br><span class="line">        MySQL主键约束是⼀个列或者列的组合，其值能唯⼀地标识表中的每⼀⾏。</span><br><span class="line">        这样的⼀列或多列称为表的主键，通过它可以强制表的实体完整性。</span><br></pre></td></tr></table></figure>
<p>使用工具创建表：</p>
<p><img src="https://oldboy-ma.oss-cn-shenzhen.aliyuncs.com/immages/202208061538236.png" alt="image-20220802203049141"></p>
<p>使⽤⼯具查看建表语句:</p>
<p><img src="https://oldboy-ma.oss-cn-shenzhen.aliyuncs.com/immages/202208022033757.png" alt="image-20220802203343687" style="zoom: 50%;" /></p>
<p>建表语句如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `school`.`Untitled`  (</span><br><span class="line">  `cno` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;课程编号&#x27;</span>,</span><br><span class="line">  `cname` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_general_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;课程名字&#x27;</span>,</span><br><span class="line">  `tno` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;教师编号&#x27;</span></span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_general_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-查看表和表结构"><a href="#2-3-查看表和表结构" class="headerlink" title="2.3 查看表和表结构"></a>2.3 查看表和表结构</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">查看表</span><br><span class="line">use school;</span><br><span class="line"><span class="keyword">show</span> tables;</span><br><span class="line"></span><br><span class="line">查看⻅表语句</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> student;</span><br><span class="line"></span><br><span class="line">查看表结构</span><br><span class="line"><span class="keyword">desc</span> student;</span><br></pre></td></tr></table></figure>
<h5 id="2-4-复制⼀张表"><a href="#2-4-复制⼀张表" class="headerlink" title="2.4 复制⼀张表"></a>2.4 复制⼀张表</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stu <span class="keyword">like</span> student;</span><br></pre></td></tr></table></figure>
<h5 id="2-5-修改表定义"><a href="#2-5-修改表定义" class="headerlink" title="2.5 修改表定义"></a>2.5 修改表定义</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">增加列：增加telnum列</span><br><span class="line">  推荐的⽅式，在最后⼀列后添加，</span><br><span class="line">use school;</span><br><span class="line"><span class="keyword">DESC</span> `student`;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `student`</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">COLUMN</span> telnum <span class="type">CHAR</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">UNIQUE</span> KEY <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;⼿机号&#x27;</span> ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">不建议的⽅式：</span><br><span class="line">  在gender列后增加列</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> oldboy.student</span><br><span class="line"><span class="keyword">add</span> <span class="keyword">column</span> a <span class="type">CHAR</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span> key <span class="keyword">default</span> <span class="string">&#x27;0&#x27;</span> comment <span class="string">&#x27;⼿机号&#x27;</span> after gender ;</span><br><span class="line"><span class="keyword">desc</span> student;</span><br><span class="line"></span><br><span class="line">在第⼀列添加列</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> oldboy.student</span><br><span class="line"><span class="keyword">add</span> <span class="keyword">column</span> b <span class="type">CHAR</span>(<span class="number">11</span>) <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">unique</span> key <span class="keyword">default</span> <span class="string">&#x27;0&#x27;</span> comment <span class="string">&#x27;⼿机号&#x27;</span> <span class="keyword">first</span> ;</span><br><span class="line"><span class="keyword">desc</span> student;</span><br><span class="line"></span><br><span class="line">删除列：（不代表⽣产操作，危险！！！！）</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">drop</span> a;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">drop</span> b;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">drop</span> telnum;</span><br></pre></td></tr></table></figure>
<h5 id="2-6-修改表属性"><a href="#2-6-修改表属性" class="headerlink" title="2.6 修改表属性"></a>2.6 修改表属性</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">修改表名：</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> student RENAME <span class="keyword">TO</span> st;</span><br><span class="line"></span><br><span class="line">修改引擎：</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1(id <span class="type">INT</span>) ENGINE<span class="operator">=</span>MYISAM;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t1 ENGINE<span class="operator">=</span>INNODB;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1;</span><br><span class="line"></span><br><span class="line">修改字符集：</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t2(id <span class="type">INT</span>) CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t2;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t2 CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t2;</span><br></pre></td></tr></table></figure>
<h5 id="2-7-修改列属性"><a href="#2-7-修改列属性" class="headerlink" title="2.7 修改列属性"></a>2.7 修改列属性</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">修改列名：</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> st CHANGE shenfen cardnum <span class="type">CHAR</span>(<span class="number">18</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span> COMMENT <span class="string">&#x27;身份证&#x27;</span>;</span><br><span class="line"></span><br><span class="line">修改默认值：</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> st CHANGE cardnum cardnum <span class="type">CHAR</span>(<span class="number">18</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;身份证&#x27;</span>;</span><br><span class="line"></span><br><span class="line">修改数据类型：</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> st MODIFY cardnum <span class="type">CHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;身份证&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h5 id="2-8-删除表"><a href="#2-8-删除表" class="headerlink" title="2.8 删除表"></a>2.8 删除表</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> st;</span><br></pre></td></tr></table></figure>
<h3 id="四-DCL-数据控制语言"><a href="#四-DCL-数据控制语言" class="headerlink" title="四 DCL 数据控制语言"></a>四 DCL 数据控制语言</h3><h4 id="可利用-DCL-控制的权限"><a href="#可利用-DCL-控制的权限" class="headerlink" title="可利用 DCL 控制的权限"></a>可利用 DCL 控制的权限</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DCL     以控制用户的访问权限为主，因此其指令作法并不复杂，</span><br><span class="line"><span class="keyword">CONNECT</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line"><span class="keyword">INSERT</span></span><br><span class="line"><span class="keyword">UPDATE</span></span><br><span class="line"><span class="keyword">DELETE</span></span><br><span class="line"><span class="keyword">EXECUTE</span></span><br><span class="line">USAGE</span><br><span class="line"><span class="keyword">REFERENCES</span></span><br></pre></td></tr></table></figure>
<h4 id="语法结构"><a href="#语法结构" class="headerlink" title="语法结构"></a>语法结构</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">根据不同的DBMS以及不同的安全性实体，其支持的权限控制也有所不同。</span><br><span class="line"></span><br><span class="line">GRANT的语法结构为：</span><br><span class="line">GRANT [权限] ON [要授予权限的资料库物件] TO [使用者帐户名称] WITH [授权选项]</span><br><span class="line"></span><br><span class="line">DENY的语法结构为：</span><br><span class="line">DENY [权限] ON [要授予权限的资料库物件] TO [使用者帐户名称]</span><br></pre></td></tr></table></figure>
<h3 id="五-DML-数据操作语⾔"><a href="#五-DML-数据操作语⾔" class="headerlink" title="五 DML 数据操作语⾔"></a>五 DML 数据操作语⾔</h3><h4 id="1-INSERT-插⼊表数据"><a href="#1-INSERT-插⼊表数据" class="headerlink" title="1.INSERT 插⼊表数据"></a>1.INSERT 插⼊表数据</h4><p>建表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">use school;</span><br><span class="line">CREATE TABLE `st` (</span><br><span class="line"> `id` int(11) NOT NULL AUTO_INCREMENT COMMENT &#x27;学号&#x27;,</span><br><span class="line"> `name` varchar(64) COLLATE utf8mb4_bin NOT NULL COMMENT &#x27;学⽣姓名&#x27;,</span><br><span class="line"> `age` tinyint(3) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;学⽣年龄&#x27;,</span><br><span class="line"> `gender` char(1) COLLATE utf8mb4_bin NOT NULL DEFAULT &#x27;n&#x27; COMMENT &#x27;学⽣性别&#x27;,</span><br><span class="line"> `address` enum(&#x27;北京&#x27;,&#x27;深圳&#x27;,&#x27;上海&#x27;,&#x27;⼴州&#x27;,&#x27;重庆&#x27;,&#x27;未知&#x27;) COLLATE utf8mb4_bin NOT</span><br><span class="line">NULL DEFAULT &#x27;未知&#x27; COMMENT &#x27;省份&#x27;,</span><br><span class="line"> `intime` datetime NOT NULL COMMENT &#x27;⼊学时间&#x27;,</span><br><span class="line"> `cardnum` char(18) COLLATE utf8mb4_bin NOT NULL COMMENT &#x27;身份证&#x27;,</span><br><span class="line"> PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin;</span><br></pre></td></tr></table></figure>
<p>标准：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO</span><br><span class="line">st(id,NAME,age,gender,address,intime,cardnum)</span><br><span class="line">VALUES(1,&#x27;张三&#x27;,18,&#x27;m&#x27;,&#x27;北京&#x27;,&#x27;2020-09-06&#x27;,&#x27;666666&#x27;);</span><br><span class="line">SELECT * FROM st;</span><br></pre></td></tr></table></figure>
<p>部分列录⼊：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO</span><br><span class="line">st(NAME,intime)</span><br><span class="line">VALUES(&#x27;李四&#x27;,NOW());</span><br><span class="line">SELECT * FROM st;</span><br></pre></td></tr></table></figure>
<p>修改时间列的默认值为NOW()</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> st MODIFY intime DATETIME <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> NOW() COMMENT <span class="string">&#x27;⼊学时间&#x27;</span>;</span><br><span class="line"><span class="keyword">DESC</span> st;</span><br></pre></td></tr></table></figure>
<p>再次插⼊数据:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span></span><br><span class="line">st(NAME,num)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;王五&#x27;</span>,<span class="number">11112</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> st;</span><br></pre></td></tr></table></figure>
<p>省略写法:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">desc</span> st;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span></span><br><span class="line">st</span><br><span class="line"><span class="keyword">values</span>(<span class="number">5</span>,<span class="string">&#x27;张三&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;m&#x27;</span>,<span class="string">&#x27;北京&#x27;</span>,<span class="string">&#x27;2020-04-27&#x27;</span>,<span class="string">&#x27;666666&#x27;</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> st;</span><br></pre></td></tr></table></figure>
<h4 id="2-UPDATE-修改表数据"><a href="#2-UPDATE-修改表数据" class="headerlink" title="2.UPDATE 修改表数据"></a>2.UPDATE 修改表数据</h4><p>更新数据⾏:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> st <span class="keyword">SET</span> NAME<span class="operator">=</span><span class="string">&#x27;张六&#x27;</span> <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">3</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> st;</span><br><span class="line"><span class="keyword">update</span> st <span class="keyword">set</span> name<span class="operator">=</span><span class="string">&#x27;张qi&#x27;</span> , age<span class="operator">=</span><span class="number">21</span> <span class="keyword">where</span> id<span class="operator">=</span><span class="number">4</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> st;</span><br></pre></td></tr></table></figure>
<h4 id="3-DELETE-UPDATE-TRUNCATE-删除表数据"><a href="#3-DELETE-UPDATE-TRUNCATE-删除表数据" class="headerlink" title="3.DELETE/UPDATE/TRUNCATE 删除表数据"></a>3.DELETE/UPDATE/TRUNCATE 删除表数据</h4><h5 id="3-1-DELETE"><a href="#3-1-DELETE" class="headerlink" title="3.1 DELETE"></a>3.1 DELETE</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM st WHERE id=3;</span><br><span class="line">SELECT * FROM st;</span><br></pre></td></tr></table></figure>
<h5 id="3-2-伪删除"><a href="#3-2-伪删除" class="headerlink" title="3.2 伪删除"></a>3.2 伪删除</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> 替代 dalete, 添加状态列，<span class="number">1</span>代表存在，<span class="number">0</span>代表删除</span><br><span class="line">第⼀步：增加状态列</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> st <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> state TINYINT <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span> COMMENT <span class="string">&#x27;状态列,0是删除,1是</span></span><br><span class="line"><span class="string">存在&#x27;</span>;</span><br><span class="line"><span class="keyword">DESC</span> st;</span><br><span class="line"></span><br><span class="line">第⼆步：使⽤<span class="keyword">update</span> 替换 <span class="keyword">delete</span></span><br><span class="line">原：</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> st <span class="keyword">where</span> id<span class="operator">=</span><span class="number">4</span></span><br><span class="line">修改后：</span><br><span class="line"><span class="keyword">UPDATE</span> st <span class="keyword">SET</span> state<span class="operator">=</span><span class="number">0</span> <span class="keyword">WHERE</span> id<span class="operator">=</span><span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">第三步：替换原来查询业务语句</span><br><span class="line">原：　</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> st;</span><br><span class="line">改变后：　</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> st <span class="keyword">WHERE</span> state<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="4-⾯试题"><a href="#4-⾯试题" class="headerlink" title="4.⾯试题"></a>4.⾯试题</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table t1,truncate table t1,delete from t1 区别？</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">drop table t1; </span><br><span class="line">作⽤：</span><br><span class="line">1.删除所有表数据，删除整个表段（rm ibd ）,属于物理性质，会释放磁盘空间。</span><br><span class="line">2.删除表定义 (rm frm , 元数据也会被删除)</span><br><span class="line"> </span><br><span class="line">truncate table t1;</span><br><span class="line">作⽤：</span><br><span class="line">1.保留表结构，清空表段中的数据⻚。属于物理删除，会释放磁盘空间。</span><br><span class="line">delete from t1;</span><br><span class="line">作⽤:</span><br><span class="line">1.删除数据⾏。逐⾏删除。保留表结构，属于逻辑性质删除。只是标记删除，不会⽴即释放磁盘空间。</span><br><span class="line">2.所以delete操作会产⽣碎⽚。</span><br></pre></td></tr></table></figure>
<h3 id="六-DQL数据查询语⾔"><a href="#六-DQL数据查询语⾔" class="headerlink" title="六 DQL数据查询语⾔"></a>六 DQL数据查询语⾔</h3><h4 id="1-SQL查询语句-SELECT"><a href="#1-SQL查询语句-SELECT" class="headerlink" title="1. SQL查询语句-SELECT"></a>1. SQL查询语句-SELECT</h4><h5 id="1-1-SELECT-语句"><a href="#1-1-SELECT-语句" class="headerlink" title="1.1 SELECT 语句"></a>1.1 SELECT 语句</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT 语句用于从表中选取数据。</span><br><span class="line">结果被存储在一个结果表中（称为结果集）。</span><br><span class="line">SQL SELECT 语法</span><br><span class="line">SELECT 列名称 FROM 表名称 以及 SELECT * FROM 表名称</span><br><span class="line">注释：SQL 语句对大小写不敏感。SELECT 等效于 select。</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"><strong>操作符</strong></th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">=</td>
<td style="text-align:center">等于</td>
</tr>
<tr>
<td style="text-align:center">&lt;&gt;</td>
<td style="text-align:center">不等于</td>
</tr>
<tr>
<td style="text-align:center">&gt;</td>
<td style="text-align:center">大于</td>
</tr>
<tr>
<td style="text-align:center">&lt;</td>
<td style="text-align:center">小于</td>
</tr>
<tr>
<td style="text-align:center">&gt;=</td>
<td style="text-align:center">大于等于</td>
</tr>
<tr>
<td style="text-align:center">&lt;=</td>
<td style="text-align:center">小于等于</td>
</tr>
<tr>
<td style="text-align:center">BETWEEN</td>
<td style="text-align:center">在某个范围内</td>
</tr>
<tr>
<td style="text-align:center">LIKE</td>
<td style="text-align:center">搜索某种模式</td>
</tr>
</tbody>
</table>
</div>
<h5 id="1-2-WHERE-子句"><a href="#1-2-WHERE-子句" class="headerlink" title="1.2 WHERE 子句"></a>1.2 WHERE 子句</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WHERE</span> 子句用于规定选择的标准。</span><br><span class="line">有条件地从表中选取数据，可将 <span class="keyword">WHERE</span> 子句添加到 <span class="keyword">SELECT</span> 语句。</span><br><span class="line">语法</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  列名称 </span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">  表名称 </span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">  列 运算符;</span><br><span class="line">值下面的运算符可在 <span class="keyword">WHERE</span> 子句中使用：</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">请注意:</span><br><span class="line">SQL 使用单引号来环绕&#x27;文本值&#x27;（大部分数据库系统也接受双引号）。</span><br><span class="line">如果是数值，请不要使用引号。</span><br></pre></td></tr></table></figure>
<h4 id="2-举例"><a href="#2-举例" class="headerlink" title="2.举例"></a>2.举例</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>创建远程账号</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> privileges <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> root@&quot;%&quot; identified <span class="keyword">by</span> <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">user</span>,host <span class="keyword">from</span> mysql.user;</span><br><span class="line"></span><br><span class="line">#<span class="number">1.</span>查询表里所有的数据</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">  city;</span><br><span class="line"></span><br><span class="line">#<span class="number">2.</span>查询部分字段的数据</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  NAME,</span><br><span class="line">  Countrycode </span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">  city;</span><br><span class="line"></span><br><span class="line">#<span class="number">3.</span>查询city表中，所有中国的城市信息<span class="comment">--&gt;CHN</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">  city </span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">  Countrycode <span class="operator">=</span> <span class="string">&#x27;CHN&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">4.</span>查询city表中，城市名称叫北京的信息</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">  city </span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">  NAME <span class="operator">=</span> <span class="string">&#x27;peking&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">5.</span>查询人口数小于<span class="number">100</span>人城市信息</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">  city </span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">  Population <span class="operator">&lt;</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">6.</span>查询中国,人口数超过<span class="number">500</span>w的所有城市信息</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">  city </span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">  CountryCode <span class="operator">=</span> <span class="string">&#x27;CHN&#x27;</span> </span><br><span class="line"><span class="keyword">AND</span> </span><br><span class="line">Population <span class="operator">&gt;</span> <span class="number">5000000</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">7.</span>查询中国或美国的城市信息</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  city </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">  CountryCode <span class="operator">=</span> <span class="string">&#x27;CHN&#x27;</span> </span><br><span class="line"><span class="keyword">OR</span> </span><br><span class="line">  CountryCode <span class="operator">=</span> <span class="string">&#x27;USA&#x27;</span>;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">  city</span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">  CountryCode </span><br><span class="line">  <span class="keyword">IN</span> </span><br><span class="line">  (<span class="string">&#x27;CHN&#x27;</span>,<span class="string">&#x27;USA&#x27;</span>);</span><br><span class="line"></span><br><span class="line">#<span class="number">8.</span>查询中国人口数为<span class="number">100</span>w<span class="number">-200</span>w（包括两头）城市名和人口信息以及国家代码</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  NAME,</span><br><span class="line">  Population,</span><br><span class="line">  countrycode </span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">  city </span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">  CountryCode <span class="operator">=</span> <span class="string">&#x27;CHN&#x27;</span> </span><br><span class="line"><span class="keyword">AND</span> </span><br><span class="line">  Population <span class="operator">&gt;=</span> <span class="number">1000000</span> </span><br><span class="line"><span class="keyword">AND</span> </span><br><span class="line">  Population <span class="operator">&lt;=</span> <span class="number">2000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  NAME,</span><br><span class="line">  Population,</span><br><span class="line">  countrycode </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  city </span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">  CountryCode <span class="operator">=</span> <span class="string">&#x27;CHN&#x27;</span> </span><br><span class="line"><span class="keyword">AND</span> </span><br><span class="line">  Population </span><br><span class="line"><span class="keyword">BETWEEN</span> </span><br><span class="line">  <span class="number">1000000</span> </span><br><span class="line"><span class="keyword">AND</span> </span><br><span class="line">  <span class="number">2000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  NAME,</span><br><span class="line">  Population,</span><br><span class="line">  countrycode</span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">  city</span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line">  CountryCode <span class="operator">=</span> <span class="string">&#x27;CHN&#x27;</span></span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line">  Population <span class="operator">&gt;=</span> <span class="number">1000000</span></span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line">  Population <span class="operator">&lt;=</span> <span class="number">2000000</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">9.</span>查询中国或美国，人口数大于<span class="number">500</span>w的城市</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> city</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">CountryCode <span class="keyword">IN</span> (<span class="string">&#x27;CHN&#x27;</span>,<span class="string">&#x27;USA&#x27;</span>)</span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line">Population <span class="operator">&gt;</span> <span class="number">5000000</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">10.</span>查询中国城市名为qing开头的城市信息</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> city</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">CountryCode <span class="operator">=</span> <span class="string">&#x27;CHN&#x27;</span></span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line">NAME <span class="keyword">LIKE</span> <span class="string">&#x27;qing%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">#<span class="number">11.</span>查询中国城市名为jing结尾的城市信息</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> city</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">CountryCode <span class="operator">=</span> <span class="string">&#x27;CHN&#x27;</span></span><br><span class="line"><span class="keyword">AND</span></span><br><span class="line">NAME </span><br><span class="line"><span class="keyword">LIKE</span> <span class="string">&#x27;%jing&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="3-GROUP-BY-聚合函数"><a href="#3-GROUP-BY-聚合函数" class="headerlink" title="3. GROUP BY 聚合函数"></a>3. GROUP BY 聚合函数</h4><h5 id="3-1-什么是GROUP-BY"><a href="#3-1-什么是GROUP-BY" class="headerlink" title="3.1 什么是GROUP BY?"></a>3.1 什么是GROUP BY?</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">就是对select的查询结果基础之上,再次进行某些运算</span><br></pre></td></tr></table></figure>
<h5 id="3-2-聚合函数都有哪些"><a href="#3-2-聚合函数都有哪些" class="headerlink" title="3.2 聚合函数都有哪些"></a>3.2 聚合函数都有哪些</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">count()            统计行数</span><br><span class="line">sum()              求和</span><br><span class="line">avg()              平均数</span><br><span class="line">max()              最大值</span><br><span class="line">min()              最小值</span><br><span class="line">group_concat()     列转行</span><br></pre></td></tr></table></figure>
<h5 id="3-3-group-by-分组功能原理"><a href="#3-3-group-by-分组功能原理" class="headerlink" title="3.3 group by 分组功能原理"></a>3.3 group by 分组功能原理</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1)按照分组条件进行排序</span><br><span class="line">2)进行分组列的去重复</span><br><span class="line">3)聚合函数将其他列的结果进行聚合。</span><br></pre></td></tr></table></figure>
<h4 id="4-ORDER-BY-聚合排序"><a href="#4-ORDER-BY-聚合排序" class="headerlink" title="4 ORDER BY 聚合排序"></a>4 ORDER BY 聚合排序</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ORDER BY 语句用于对结果集进行排序。</span><br><span class="line">ASC：升序（默认），DESC：降序。</span><br></pre></td></tr></table></figure>
<h4 id="5-HAVING-聚合判断"><a href="#5-HAVING-聚合判断" class="headerlink" title="5 HAVING 聚合判断"></a>5 HAVING 聚合判断</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HAVING语句通常与GROUP BY语句联合使用，用来过滤由GROUP BY语句返回的记录集。</span><br><span class="line">HAVING语句的存在弥补了WHERE关键字不能与聚合函数联合使用的不足。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="6-LIMIT-分页查询"><a href="#6-LIMIT-分页查询" class="headerlink" title="6 LIMIT 分页查询"></a>6 LIMIT 分页查询</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">limit子句用于限制查询结果返回的数量，常用于分页查询</span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  <span class="operator">*</span> </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">  tableName </span><br><span class="line">limit </span><br><span class="line">  i,n</span><br><span class="line">  </span><br><span class="line"># tableName：表名</span><br><span class="line"># i：为查询结果的索引值(默认从<span class="number">0</span>开始)，当i<span class="operator">=</span><span class="number">0</span>时可省略i</span><br><span class="line"># limit n 等同于 limit <span class="number">0</span>,n</span><br><span class="line"># n：为查询结果返回的数量</span><br><span class="line"># i与n之间使用英文逗号&quot;,&quot;隔开</span><br></pre></td></tr></table></figure>
<h4 id="7-⼦句执⾏顺序"><a href="#7-⼦句执⾏顺序" class="headerlink" title="7.⼦句执⾏顺序"></a>7.⼦句执⾏顺序</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select select_list from where group_by having order by limit</span><br><span class="line"> 4 1 2 3 5 6 7 </span><br><span class="line"> </span><br><span class="line">select select_list 4</span><br><span class="line">from               1</span><br><span class="line">where              2</span><br><span class="line">group_by           3</span><br><span class="line">having             5</span><br><span class="line">order by           6</span><br><span class="line">limit              7</span><br></pre></td></tr></table></figure>
<h4 id="7-亿点点练习"><a href="#7-亿点点练习" class="headerlink" title="7 亿点点练习"></a>7 亿点点练习</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">查询语句联系</span><br><span class="line">1.查看指定的字段内容</span><br><span class="line">2.查询所有城市名及⼈⼝信息</span><br><span class="line">3.查询city表中，所有中国的城市信息</span><br><span class="line">4.查询⼈⼝数⼩于100⼈城市信息</span><br><span class="line">5.查询中国,⼈⼝数超过500w的所有城市信息</span><br><span class="line">6.查询中国或美国的城市信息</span><br><span class="line">7.查询⼈⼝数为100w-200w（包括两头）城市信息</span><br><span class="line">8.查询中国或美国，⼈⼝数⼤于500w的城市</span><br><span class="line">9.查询城市名为qing开头的城市信息</span><br><span class="line">10.统计city表的⾏数</span><br><span class="line">11.统计中国城市的个数</span><br><span class="line">12.统计中国的总⼈⼝数</span><br><span class="line">13.统计每个国家的城市个数</span><br><span class="line">14.统计每个国家的总⼈⼝数</span><br><span class="line">16.统计中国每个省的城市个数及城市名列表</span><br><span class="line">17.统计每个国家的城市个数,并且只显示超过100个城市的国家</span><br><span class="line">18.统计每个国家的城市个数,并且只显示超过100个城市的国家并按照从⼤到⼩排序</span><br><span class="line">19.统计每个国家的城市个数,并且只显示超过100个城市的国家并按照从⼤到⼩排序,并且只显示排名前</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.统计city表的行数</span></span><br><span class="line">SELECT COUNT(*)</span><br><span class="line">FROM city;</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.统计中国城市的个数</span></span><br><span class="line">SELECT COUNT(*)</span><br><span class="line">FROM city</span><br><span class="line">WHERE</span><br><span class="line">CountryCode = <span class="string">&#x27;CHN&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.统计中国的总人口数</span></span><br><span class="line"><span class="comment">#第一步: 取出所有中国的数据</span></span><br><span class="line"><span class="comment">#第二步: </span></span><br><span class="line">SELECT SUM(Population)</span><br><span class="line">FROM city</span><br><span class="line">WHERE</span><br><span class="line">CountryCode = <span class="string">&#x27;CHN&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.统计每个国家的城市个数 group by</span></span><br><span class="line"><span class="comment">#第一步: 只显示国家和城市字段</span></span><br><span class="line"><span class="comment">#第二步: 确定对哪个字段进行分组</span></span><br><span class="line"><span class="comment">#第三步: 对分好组后的数据进行运算</span></span><br><span class="line">SELECT CountryCode<span class="string">&#x27;国家&#x27;</span>,COUNT(NAME)<span class="string">&#x27;城市个数&#x27;</span></span><br><span class="line">FROM city</span><br><span class="line">GROUP BY CountryCode;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#5.统计每个国家的总人口数</span></span><br><span class="line"><span class="comment">#第一步: 只显示国家和人口字段</span></span><br><span class="line"><span class="comment">#第二步: 确定对哪个字段进行分组    国家</span></span><br><span class="line"><span class="comment">#第三步: 对分好组后的数据进行运算  人口</span></span><br><span class="line">SELECT CountryCode,SUM(Population)</span><br><span class="line">FROM city</span><br><span class="line">GROUP BY CountryCode</span><br><span class="line"></span><br><span class="line"><span class="comment">#6.统计中国每个省的城市个数  及 城市名列表</span></span><br><span class="line"><span class="comment">#第一步: 保留哪些结果  中国 省 城市</span></span><br><span class="line"><span class="comment">#第二步: 对谁进行分组  省</span></span><br><span class="line"><span class="comment">#第三步: 分组后做什么计算 name</span></span><br><span class="line">SELECT District,COUNT(NAME),GROUP_CONCAT(NAME)</span><br><span class="line">FROM city</span><br><span class="line">WHERE CountryCode = <span class="string">&#x27;CHN&#x27;</span></span><br><span class="line">GROUP BY District</span><br><span class="line"></span><br><span class="line"><span class="comment">#7.计算人口数超过1亿的国家</span></span><br><span class="line"><span class="comment">#第一步: 保留哪些结果  国家 人口</span></span><br><span class="line"><span class="comment">#第二步: 对谁进行分组  国家</span></span><br><span class="line"><span class="comment">#第三步: 分组后做什么计算  人口求和  计算</span></span><br><span class="line">SELECT CountryCode,SUM(Population)</span><br><span class="line">FROM city</span><br><span class="line">GROUP BY CountryCode</span><br><span class="line">HAVING SUM(Population) &gt; 100000000;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#8.统计中国每个省的人口数量,将超过100万的省按照倒序排序</span></span><br><span class="line"><span class="comment">#第一步: 保留哪些结果  中国  省  人口</span></span><br><span class="line"><span class="comment">#第二步: 对谁进行分组  省</span></span><br><span class="line"><span class="comment">#第三步: 分组后做什么计算  人口求和&gt;100万</span></span><br><span class="line"><span class="comment">#第四步: 进行什么排序</span></span><br><span class="line">升序：</span><br><span class="line">SELECT District,SUM(Population)</span><br><span class="line">FROM city</span><br><span class="line">WHERE CountryCode = <span class="string">&#x27;CHN&#x27;</span></span><br><span class="line">GROUP BY District</span><br><span class="line">HAVING SUM(Population) &gt; 1000000</span><br><span class="line">ORDER BY SUM(Population)</span><br><span class="line"></span><br><span class="line">降序：</span><br><span class="line">SELECT District,SUM(Population)</span><br><span class="line">FROM city</span><br><span class="line">WHERE CountryCode = <span class="string">&#x27;CHN&#x27;</span></span><br><span class="line">GROUP BY District</span><br><span class="line">HAVING SUM(Population) &gt; 1000000</span><br><span class="line">ORDER BY SUM(Population)</span><br><span class="line">DESC</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#9.计算人口数超过5000万的国家并且降序排序</span></span><br><span class="line"><span class="comment">#第一步: 保留哪些结果 国家 人口</span></span><br><span class="line"><span class="comment">#第二步: 对谁进行分组 国家</span></span><br><span class="line"><span class="comment">#第三步: 分组后做什么计算 人口求和&gt;5000万</span></span><br><span class="line"><span class="comment">#第四步: 进行什么排序 人口</span></span><br><span class="line">SELECT CountryCode,SUM(Population)</span><br><span class="line">FROM city</span><br><span class="line">GROUP BY CountryCode</span><br><span class="line">HAVING SUM(Population) &gt; 50000000</span><br><span class="line">ORDER BY SUM(Population)</span><br><span class="line">DESC</span><br><span class="line"></span><br><span class="line"><span class="comment">#10.统计中国每个省的城市个数及城市名列表,人口超过200万,排序,只显示前5个</span></span><br><span class="line"><span class="comment">#第一步: 保留哪些结果 中国 省 城市 人口</span></span><br><span class="line"><span class="comment">#第二步: 对谁进行分组 省</span></span><br><span class="line"><span class="comment">#第三步: 分组后做什么计算 城市个数 城市名 人口</span></span><br><span class="line"><span class="comment">#第四步: 进行什么排序 人口</span></span><br><span class="line">SELECT district<span class="string">&#x27;省会&#x27;</span>,COUNT(NAME)<span class="string">&#x27;城市个数&#x27;</span>,SUM(Population)<span class="string">&#x27;人口&#x27;</span>,GROUP_CONCAT(NAME)<span class="string">&#x27;城市名字&#x27;</span></span><br><span class="line">FROM city</span><br><span class="line">WHERE CountryCode = <span class="string">&#x27;CHN&#x27;</span></span><br><span class="line">GROUP BY district</span><br><span class="line">HAVING SUM(Population) &gt; 2000000</span><br><span class="line">ORDER BY SUM(Population)</span><br><span class="line">DESC</span><br><span class="line">LIMIT 5;</span><br></pre></td></tr></table></figure>
<h2 id="第3章-聚簇-区-索引"><a href="#第3章-聚簇-区-索引" class="headerlink" title="第3章 聚簇(区)索引"></a>第3章 聚簇(区)索引</h2><h3 id="1-索引理论"><a href="#1-索引理论" class="headerlink" title="1.索引理论"></a>1.索引理论</h3><h4 id="1-1-什么叫索引"><a href="#1-1-什么叫索引" class="headerlink" title="1.1 什么叫索引"></a>1.1 什么叫索引</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">假如表是一本书,索引就是这本书的目录</span><br><span class="line">数据库索引的目的就是为了更快的找到我们要的数据</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">优点：</span><br><span class="line">索引大大减小了服务器需要扫描的数据量</span><br><span class="line">索引可以帮助服务器避免排序和临时表</span><br><span class="line">索引可以将随机IO变成顺序IO</span><br><span class="line"></span><br><span class="line">缺点：</span><br><span class="line">虽然索引大大提高了查询速度，同时却会降低更新表的速度。因为更新表时，MySQL不仅要保存数据，还要保存索引文件。</span><br><span class="line"></span><br><span class="line">建立索引会占用磁盘空间的索引文件。一般情况这个问题不太严重，但如果你在一个大表上创建了多种组合索引，索引文件的会膨胀很快。</span><br><span class="line"></span><br><span class="line">如果某个数据列包含许多重复的内容，为它建立索引就没有太大的实际效果。</span><br><span class="line"></span><br><span class="line">对于非常小的表，大部分情况下简单的全表扫描更高效；</span><br><span class="line"></span><br><span class="line">索引只是提高效率的一个因素，如果你的MySQL有大数据量的表，就需要花时间研究建立最优秀的索引，或优化查询语句。</span><br><span class="line"></span><br><span class="line">因此应该只为最经常查询和最经常排序的数据列建立索引。</span><br><span class="line"></span><br><span class="line">MySQL里同一个数据表里的索引总数限制为16个。</span><br></pre></td></tr></table></figure>
<h4 id="1-2-平衡树"><a href="#1-2-平衡树" class="headerlink" title="1.2 平衡树"></a>1.2 平衡树</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BTREE</span><br><span class="line">B<span class="operator">+</span>TREE</span><br><span class="line">B<span class="operator">+</span><span class="operator">+</span>TREE</span><br></pre></td></tr></table></figure>
<h4 id="1-3-前提"><a href="#1-3-前提" class="headerlink" title="1.3 前提"></a>1.3 前提</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>)如果表中设置了主键（例如ID列），自动根据ID列生成索引树。</span><br><span class="line"><span class="number">2</span>)如果没有设置主键，自动选择第一个唯一键的列作为聚簇索引</span><br><span class="line"><span class="number">3</span>)自动生成隐藏的聚簇索引。</span><br></pre></td></tr></table></figure>
<h4 id="1-4-构建过程"><a href="#1-4-构建过程" class="headerlink" title="1.4 构建过程"></a>1.4 构建过程</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>)叶子节点: 存储数据行时就是有序的，直接将数据行的page作为叶子节点（相邻的叶子结点，有双向指针）</span><br><span class="line"><span class="number">2</span>)枝节点: 提取叶子节点ID的范围<span class="operator">+</span>指针，构建枝节点（相邻枝节点，有双向指针）</span><br><span class="line"><span class="number">3</span>)根节点: 提取枝节点的ID的范围<span class="operator">+</span>指针，构建根节点</span><br></pre></td></tr></table></figure>
<h4 id="1-5-查询语句"><a href="#1-5-查询语句" class="headerlink" title="1.5 查询语句"></a>1.5 查询语句</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查询的语句条件为id列这样是最快的,因为这样直接就可以根据索引很快查到数据存储的位置</span><br></pre></td></tr></table></figure>
<h3 id="2-辅助索引"><a href="#2-辅助索引" class="headerlink" title="2 辅助索引"></a>2 辅助索引</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>条件</span><br><span class="line">需要人为创建辅助索引，将经常作为查询条件的列创建辅助索引，起到加速查询的效果。</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>功能</span><br><span class="line">按照辅助索引列，作为查询条件时。</span><br><span class="line"><span class="number">1.</span>查找辅助索引树，得到ID值</span><br><span class="line"><span class="number">2.</span>拿着ID值回表（聚簇索引）查询</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>辅助索引生成过程</span><br><span class="line"><span class="number">1.</span>叶子节点：提取主键（ID）<span class="operator">+</span>辅助索引列，按照辅助索引列进行从小到大排序后，生成叶子节点。（相邻的叶子结点，有双向指针）</span><br><span class="line"><span class="number">2.</span>枝节点  ：提取叶子节点辅助索引列的范围<span class="operator">+</span>指针，构建枝节点（相邻枝节点，有双向指针）</span><br><span class="line"><span class="number">3.</span>根节点  ：提取枝节点的辅助索引列的范围<span class="operator">+</span>指针，构建根节点</span><br></pre></td></tr></table></figure>
<h3 id="3-索引应用"><a href="#3-索引应用" class="headerlink" title="3. 索引应用"></a>3. 索引应用</h3><h4 id="3-1-压测"><a href="#3-1-压测" class="headerlink" title="3.1 压测"></a>3.1 压测</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>padmin <span class="operator">&lt;</span> t100w.sql</span><br><span class="line">mysqlslap \</span><br><span class="line"><span class="comment">--defaults-file=/etc/my.cnf \</span></span><br><span class="line"><span class="comment">--concurrency=100 \</span></span><br><span class="line"><span class="comment">--iterations=1 \</span></span><br><span class="line"><span class="comment">--create-schema=&#x27;test&#x27; \</span></span><br><span class="line"><span class="comment">--query=&quot;select * from test.t100w where k2=&#x27;780P&#x27;&quot; \</span></span><br><span class="line">engine<span class="operator">=</span>innodb \</span><br><span class="line"><span class="comment">--number-of-queries=200 \</span></span><br><span class="line"><span class="operator">-</span>uroot <span class="operator">-</span>padmin \</span><br><span class="line"><span class="operator">-</span>verbose <span class="operator">-</span>S <span class="operator">/</span>tmp<span class="operator">/</span>mysql_3306.sock</span><br><span class="line"></span><br><span class="line">mysqlslap \</span><br><span class="line"><span class="comment">--defaults-file=/etc/my.cnf \</span></span><br><span class="line"><span class="comment">--concurrency=100 \</span></span><br><span class="line"><span class="comment">--iterations=1 \</span></span><br><span class="line"><span class="comment">--create-schema=&#x27;test&#x27; \</span></span><br><span class="line"><span class="comment">--query=&quot;select * from test.t100w where id=&#x27;780P&#x27;&quot; \</span></span><br><span class="line">engine<span class="operator">=</span>innodb \</span><br><span class="line"><span class="comment">--number-of-queries=200 \</span></span><br><span class="line"><span class="operator">-</span>uroot <span class="operator">-</span>padmin \</span><br><span class="line"><span class="operator">-</span>verbose <span class="operator">-</span>S <span class="operator">/</span>tmp<span class="operator">/</span>mysql_3306.sock</span><br></pre></td></tr></table></figure>
<h4 id="3-2-查看索引"><a href="#3-2-查看索引" class="headerlink" title="3.2 查看索引"></a>3.2 查看索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">desc</span> t100w;</span><br><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> t100w;</span><br><span class="line"></span><br><span class="line">索引类型：</span><br><span class="line"><span class="comment">-----</span></span><br><span class="line">Key</span><br><span class="line"><span class="comment">-----</span></span><br><span class="line">PK <span class="comment">--&gt; 主键（聚簇索引）</span></span><br><span class="line">MUL <span class="comment">--&gt; 辅助索引 </span></span><br><span class="line">UK <span class="comment">--&gt; 唯⼀索引 </span></span><br></pre></td></tr></table></figure>
<h4 id="3-3-创建辅助索引"><a href="#3-3-创建辅助索引" class="headerlink" title="3.3 创建辅助索引"></a>3.3 创建辅助索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> test.t100w <span class="keyword">where</span> k2<span class="operator">=</span><span class="string">&#x27;780P&#x27;</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> t100w <span class="keyword">add</span> index idx_k2(k2);</span><br><span class="line"></span><br><span class="line">优化⽅法：</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> index 索引名(列名);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> t100w <span class="keyword">add</span> index idx_k2(k2);</span><br></pre></td></tr></table></figure>
<h4 id="3-4-删除索引"><a href="#3-4-删除索引" class="headerlink" title="3.4 删除索引"></a>3.4 删除索引</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> city <span class="keyword">drop</span> index idx_n;</span><br></pre></td></tr></table></figure>
<h3 id="4-执⾏计划获取和分析"><a href="#4-执⾏计划获取和分析" class="headerlink" title="4 执⾏计划获取和分析"></a>4 执⾏计划获取和分析</h3><h4 id="4-1-命令介绍"><a href="#4-1-命令介绍" class="headerlink" title="4.1 命令介绍"></a>4.1 命令介绍</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain</span><br><span class="line">desc</span><br></pre></td></tr></table></figure>
<h4 id="4-2-什么叫执行计划"><a href="#4-2-什么叫执行计划" class="headerlink" title="4.2 什么叫执行计划"></a>4.2 什么叫执行计划</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">分析你的SQL查询语句走不走索引</span><br></pre></td></tr></table></figure>
<h4 id="4-3-使用方法"><a href="#4-3-使用方法" class="headerlink" title="4.3 使用方法"></a>4.3 使用方法</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> city <span class="keyword">where</span> countrycode<span class="operator">=</span><span class="string">&#x27;CHN&#x27;</span>;</span><br><span class="line">mysql<span class="operator">&gt;</span> explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> city <span class="keyword">where</span> countrycode<span class="operator">=</span><span class="string">&#x27;CHN&#x27;</span>;</span><br><span class="line"></span><br><span class="line">在查找语句前使用命令，即可返回执行计划</span><br></pre></td></tr></table></figure>
<h4 id="4-4-执⾏计划信息介绍"><a href="#4-4-执⾏计划信息介绍" class="headerlink" title="4.4 执⾏计划信息介绍"></a>4.4 执⾏计划信息介绍</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">table ：此次查询访问的表</span><br><span class="line">type ：索引查询的类型（ALL、index、range、ref、eq_ref、const(system)、NULL）</span><br><span class="line">possible_keys ：可能会应⽤的索引</span><br><span class="line">key : 最终选择的索引</span><br><span class="line">key_len ：索引覆盖⻓度，主要是⽤来判断联合索引应⽤⻓度。</span><br><span class="line">rows ：需要扫描的⾏数</span><br><span class="line">Extra ：额外信息</span><br></pre></td></tr></table></figure>
<h4 id="4-5-索引类型"><a href="#4-5-索引类型" class="headerlink" title="4.5 索引类型"></a>4.5 索引类型</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALL</span>			    没有使用到索引</span><br><span class="line">index           全索引扫描 </span><br><span class="line"><span class="keyword">range</span>           索引范围扫描 </span><br><span class="line"><span class="keyword">ref</span>             辅助索引等值查询</span><br><span class="line">eq_ref          多表连接查询中，非驱动表的连接条件是主键或唯一键时</span><br><span class="line">const(<span class="keyword">system</span>)   主键或唯一键等值查询</span><br><span class="line"><span class="keyword">NULL</span>            没查到数据</span><br></pre></td></tr></table></figure>
<h3 id="5-key-len"><a href="#5-key-len" class="headerlink" title="5 key_len"></a>5 key_len</h3><h4 id="5-1-key-len介绍"><a href="#5-1-key-len介绍" class="headerlink" title="5.1 key_len介绍"></a>5.1 key_len介绍</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">简单来讲,key_len就是查看你的联合索引的匹配度</span><br></pre></td></tr></table></figure>
<h4 id="5-2-key-len计算"><a href="#5-2-key-len计算" class="headerlink" title="5.2 key_len计算"></a>5.2 key_len计算</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">key_len<span class="operator">=</span>a<span class="operator">+</span>b<span class="operator">+</span>c</span><br><span class="line">列的key_len长度，按照每列的最大预留长度来做的计算。</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t1 (</span><br><span class="line">id <span class="type">int</span>,</span><br><span class="line">a <span class="type">int</span> ,</span><br><span class="line">b <span class="type">char</span>(<span class="number">10</span>),</span><br><span class="line">c <span class="type">varchar</span>(<span class="number">10</span>));</span><br><span class="line"></span><br><span class="line">最大存储预留长度（字节）: </span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line">	数据类型 ：	    占用字节量	            不能为空           允许空 </span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line">	数字类型：  </span><br><span class="line">	tinyint      :  <span class="number">1</span>字节                    <span class="number">1</span>                   <span class="number">1</span><span class="operator">+</span><span class="number">1</span></span><br><span class="line">	<span class="type">int</span>          :  <span class="number">4</span>字节                    <span class="number">4</span>                   <span class="number">4</span><span class="operator">+</span><span class="number">1</span></span><br><span class="line">	<span class="type">bigint</span>       :  <span class="number">8</span>字节                    <span class="number">8</span>                   <span class="number">8</span><span class="operator">+</span><span class="number">1</span></span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line">	字符串类型： </span><br><span class="line">	utf8:  </span><br><span class="line">	<span class="type">char</span>(<span class="number">10</span>)     ： <span class="number">10</span><span class="operator">*</span><span class="number">3</span>字节 <span class="operator">=</span><span class="number">30</span>             <span class="number">30</span>                  <span class="number">30</span><span class="operator">+</span><span class="number">1</span></span><br><span class="line">	<span class="type">varchar</span>(<span class="number">10</span>)  ： <span class="number">10</span><span class="operator">*</span><span class="number">3</span><span class="operator">+</span><span class="number">2</span>字节<span class="operator">=</span><span class="number">32</span>            <span class="number">32</span>                  <span class="number">32</span><span class="operator">+</span><span class="number">1</span></span><br><span class="line"><span class="comment">-----------------------------------------------------------------------		  </span></span><br><span class="line">	utf8mb4: </span><br><span class="line">	<span class="type">char</span>(<span class="number">10</span>)     ：<span class="number">10</span><span class="operator">*</span><span class="number">4</span>字节 <span class="operator">=</span><span class="number">40</span>              <span class="number">40</span>                  <span class="number">40</span><span class="operator">+</span><span class="number">1</span></span><br><span class="line">	<span class="type">varchar</span>(<span class="number">10</span>)  ：<span class="number">10</span><span class="operator">*</span><span class="number">4</span>字节<span class="operator">+</span><span class="number">2</span> <span class="operator">=</span><span class="number">42</span>            <span class="number">42</span>                  <span class="number">42</span><span class="operator">+</span><span class="number">1</span></span><br><span class="line"><span class="comment">-----------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">use test;	</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test (</span><br><span class="line">id <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">a  <span class="type">int</span> <span class="keyword">not</span> <span class="keyword">null</span> ,                            # <span class="number">4</span>  </span><br><span class="line">b  <span class="type">int</span> ,                                     # <span class="number">5</span></span><br><span class="line">c  <span class="type">char</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span> ,                       # <span class="number">40</span></span><br><span class="line">d  <span class="type">varchar</span>(<span class="number">10</span>),                              # <span class="number">43</span></span><br><span class="line">e  <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="keyword">null</span>                      # <span class="number">42</span></span><br><span class="line">)engine<span class="operator">=</span>innodb charset<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> test <span class="keyword">add</span> index idx(a,b,c,d,e);</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>个列覆盖： </span><br><span class="line"><span class="number">4</span><span class="operator">+</span><span class="number">5</span><span class="operator">+</span><span class="number">40</span><span class="operator">+</span><span class="number">43</span><span class="operator">+</span><span class="number">42</span><span class="operator">=</span><span class="number">134</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span>个列覆盖：</span><br><span class="line"><span class="number">4</span><span class="operator">+</span><span class="number">5</span><span class="operator">+</span><span class="number">40</span><span class="operator">+</span><span class="number">43</span><span class="operator">=</span><span class="number">92</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>个列覆盖： </span><br><span class="line"><span class="number">4</span><span class="operator">+</span><span class="number">5</span><span class="operator">+</span><span class="number">40</span><span class="operator">=</span><span class="number">49</span> </span><br><span class="line"></span><br><span class="line"><span class="number">2</span>个列覆盖：</span><br><span class="line"><span class="number">4</span><span class="operator">+</span><span class="number">5</span><span class="operator">=</span><span class="number">9</span> </span><br><span class="line"></span><br><span class="line">应用<span class="number">1</span>个列：</span><br><span class="line"><span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SQL</span>语句 <span class="comment">--&gt; 实际的结果 --&gt; 最佳的结果</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">DESC</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test <span class="keyword">WHERE</span> a<span class="operator">=</span><span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">索引的所有长度    实际使用的长度</span><br><span class="line"><span class="number">134</span>				   a<span class="operator">=</span><span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DESC</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test <span class="keyword">WHERE</span> a<span class="operator">=</span><span class="string">&#x27;a&#x27;</span> <span class="keyword">and</span> b<span class="operator">=</span><span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">索引的所有长度    实际使用的长度</span><br><span class="line"><span class="number">134</span>				   a<span class="operator">+</span>b<span class="operator">=</span><span class="number">4</span><span class="operator">+</span><span class="number">5</span><span class="operator">=</span><span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DESC</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test <span class="keyword">WHERE</span> a<span class="operator">=</span><span class="string">&#x27;a&#x27;</span> <span class="keyword">and</span> b<span class="operator">=</span><span class="string">&#x27;b&#x27;</span> <span class="keyword">and</span> c<span class="operator">=</span><span class="string">&#x27;c&#x27;</span>;</span><br><span class="line">索引的所有长度    实际使用的长度</span><br><span class="line"><span class="number">134</span>				   a<span class="operator">+</span>b<span class="operator">+</span>c<span class="operator">=</span><span class="number">4</span><span class="operator">+</span><span class="number">5</span><span class="operator">+</span><span class="number">40</span><span class="operator">=</span><span class="number">49</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DESC</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test <span class="keyword">WHERE</span> a<span class="operator">=</span><span class="string">&#x27;a&#x27;</span> <span class="keyword">and</span> b<span class="operator">=</span><span class="string">&#x27;b&#x27;</span> <span class="keyword">and</span> c<span class="operator">=</span><span class="string">&#x27;c&#x27;</span> <span class="keyword">and</span> d<span class="operator">=</span><span class="string">&#x27;d&#x27;</span>;</span><br><span class="line">索引的所有长度    实际使用的长度</span><br><span class="line"><span class="number">134</span>				   a<span class="operator">+</span>b<span class="operator">+</span>c<span class="operator">=</span><span class="number">4</span><span class="operator">+</span><span class="number">5</span><span class="operator">+</span><span class="number">40</span><span class="operator">+</span><span class="number">43</span><span class="operator">=</span><span class="number">92</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DESC</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test <span class="keyword">WHERE</span> a<span class="operator">=</span><span class="string">&#x27;a&#x27;</span> <span class="keyword">and</span> b<span class="operator">=</span><span class="string">&#x27;b&#x27;</span> <span class="keyword">and</span> c<span class="operator">=</span><span class="string">&#x27;c&#x27;</span> <span class="keyword">and</span> d<span class="operator">=</span><span class="string">&#x27;d&#x27;</span> <span class="keyword">and</span> e<span class="operator">=</span><span class="string">&#x27;e&#x27;</span>;</span><br><span class="line">索引的所有长度    实际使用的长度</span><br><span class="line"><span class="number">134</span>				   a<span class="operator">+</span>b<span class="operator">+</span>c<span class="operator">=</span><span class="number">4</span><span class="operator">+</span><span class="number">5</span><span class="operator">+</span><span class="number">40</span><span class="operator">+</span><span class="number">43</span><span class="operator">+</span><span class="number">42</span><span class="operator">=</span><span class="number">138</span></span><br></pre></td></tr></table></figure>
<h4 id="3-key-len注意"><a href="#3-key-len注意" class="headerlink" title="3.key_len注意"></a>3.key_len注意</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查询语句必须包含联合索引的最左列,这样联合索引才能被匹配</span><br><span class="line">如果是多个列的联合索引,查询条件必须从左到右依次匹配上才行,否则从哪里断掉,后面的列都不匹配了</span><br><span class="line">创建联合索引需要注意的是,将重复值最少的列为最左列</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="6-不走索引的情况"><a href="#6-不走索引的情况" class="headerlink" title="6 不走索引的情况"></a>6 不走索引的情况</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">没有查询条件或者查询条件没有建立索引</span><br><span class="line"></span><br><span class="line">查询结果集是原表中的大部分数据,也就是范围搜索</span><br><span class="line"></span><br><span class="line">隐式转换导致索引失效，也就是搜索字符时，没有加<span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&lt;&gt;</span>,<span class="keyword">not</span> <span class="keyword">in</span> 不走索引</span><br><span class="line"></span><br><span class="line"><span class="keyword">like</span> &quot;%_&quot; 百分号在最前面不走</span><br></pre></td></tr></table></figure>
<h3 id="7-建立索引的原则"><a href="#7-建立索引的原则" class="headerlink" title="7 建立索引的原则"></a>7 建立索引的原则</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>必须要有主键,如果没有可以做为主键条件的列,创建无关列</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>经常做为<span class="keyword">where</span>条件列  <span class="keyword">order</span> <span class="keyword">by</span>  <span class="keyword">group</span> <span class="keyword">by</span>  <span class="keyword">join</span> <span class="keyword">on</span>, <span class="keyword">distinct</span> 的条件(业务:产品功能<span class="operator">+</span>用户行为)</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>最好使用唯一值多的列作为索引,如果索引列重复值较多,可以考虑使用联合索引</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>列值长度较长的索引列,我们建议使用前缀索引.</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>降低索引条目,一方面不要创建没用索引,不常使用的索引清理,percona toolkit(xxxxx)</span><br><span class="line"></span><br><span class="line"><span class="number">6.</span>索引维护要避开业务繁忙期，建议用pt<span class="operator">-</span>osc</span><br></pre></td></tr></table></figure>
<h2 id="第4章-mysql日志"><a href="#第4章-mysql日志" class="headerlink" title="第4章  mysql日志"></a>第4章  mysql日志</h2><h3 id="一-错误日志"><a href="#一-错误日志" class="headerlink" title="一 错误日志"></a>一 错误日志</h3><h4 id="1-日志作用"><a href="#1-日志作用" class="headerlink" title="1.日志作用"></a>1.日志作用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">记录MySQL的运行状态</span><br></pre></td></tr></table></figure>
<h4 id="2-默认位置"><a href="#2-默认位置" class="headerlink" title="2.默认位置"></a>2.默认位置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在数据库录下以 主机名.err 命名</span><br></pre></td></tr></table></figure>
<h4 id="3-配置文件参数"><a href="#3-配置文件参数" class="headerlink" title="3.配置文件参数"></a>3.配置文件参数</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br><span class="line">log_error=/data/mysql_3306/logs/mysql.err</span><br></pre></td></tr></table></figure>
<h4 id="4-坑"><a href="#4-坑" class="headerlink" title="4.坑"></a>4.坑</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line">一旦修改了默认日志的路径,则mysql启动的时候,这个日志必须存在</span><br><span class="line">而且这个日志必须是mysql拥有写入权限才行</span><br><span class="line"></span><br><span class="line"><span class="number">2</span></span><br><span class="line">初始化的时候目录必须为空</span><br><span class="line">修改了日志,启动的时候日志必须存在</span><br></pre></td></tr></table></figure>
<h3 id="二-慢日志"><a href="#二-慢日志" class="headerlink" title="二 慢日志"></a>二 慢日志</h3><h4 id="1-慢日志作用"><a href="#1-慢日志作用" class="headerlink" title="1.慢日志作用"></a>1.慢日志作用</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">定义慢语句的超时标准</span><br><span class="line">记录执行比较慢的<span class="keyword">SQL</span>语句</span><br></pre></td></tr></table></figure>
<h4 id="2-修改配置"><a href="#2-修改配置" class="headerlink" title="2.修改配置"></a>2.修改配置</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="operator">/</span>etc<span class="operator">/</span>my.cnf</span><br><span class="line">slow_query_log<span class="operator">=</span><span class="number">1</span>                                    #是否启⽤慢查询⽇志，<span class="number">1</span>为启⽤，<span class="number">0</span>为禁⽤</span><br><span class="line">slow_query_log_file<span class="operator">=</span><span class="operator">/</span>data<span class="operator">/</span>mysql_3306<span class="operator">/</span>logs<span class="operator">/</span>slow.log  #慢⽇志路径</span><br><span class="line">long_query_time<span class="operator">=</span><span class="number">0.1</span>                                 #<span class="keyword">SQL</span>语句运⾏时间阈值，执⾏时间⼤于参数值的语句才会被记录下来</span><br><span class="line">log_queries_not_using_indexes<span class="operator">=</span><span class="number">1</span>                     #将没有使⽤索引的语句记录到慢查询⽇志</span><br></pre></td></tr></table></figure>
<h4 id="3-模拟语句"><a href="#3-模拟语句" class="headerlink" title="3.模拟语句"></a>3.模拟语句</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> sleep(<span class="number">1</span>) <span class="keyword">from</span> sc;                   查询到的每一句都会睡一秒</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sc;                          sc没有索引，所以是全部查询</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t100w <span class="keyword">where</span> k1 <span class="keyword">like</span> <span class="string">&#x27;%abc&#x27;</span>;  不走索引的<span class="keyword">all</span>查询</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t100w <span class="keyword">where</span> id <span class="operator">&gt;</span> <span class="string">&#x27;1&#x27;</span>;        大范围查询也是不走索引</span><br></pre></td></tr></table></figure>
<h3 id="三-binlog日志"><a href="#三-binlog日志" class="headerlink" title="三 binlog日志"></a>三 binlog日志</h3><h4 id="1-binlog介绍"><a href="#1-binlog介绍" class="headerlink" title="1. binlog介绍"></a>1. binlog介绍</h4><h5 id="1-1-什么是binlog日志"><a href="#1-1-什么是binlog日志" class="headerlink" title="1.1 什么是binlog日志"></a>1.1 什么是binlog日志</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">简单来讲,binlog日志是记录你执行的SQL语句</span><br><span class="line">但是注意,记录的都是涉及到创建或修改的语句</span><br><span class="line">创建: 建库,建表,建字段</span><br><span class="line">修改: 修改数据,插入数据,删除数据</span><br></pre></td></tr></table></figure>
<h5 id="1-2-为什么需要binlog日志"><a href="#1-2-为什么需要binlog日志" class="headerlink" title="1.2 为什么需要binlog日志"></a>1.2 为什么需要binlog日志</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">主要用于恢复全备之后的增量数据</span><br><span class="line">因为不能实时的备份,所以一般一天一备,但是如果白天发生了误删除,那么可以从binlog日志里恢复</span><br><span class="line"></span><br><span class="line">主从复制传输数据就是从binlog里提取的</span><br></pre></td></tr></table></figure>
<h5 id="1-3-binlog三种模式"><a href="#1-3-binlog三种模式" class="headerlink" title="1.3 binlog三种模式"></a>1.3 binlog三种模式</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Statement、ROW区别： </span><br><span class="line">update t1 set name=&#x27;zhangsan&#x27; where id &lt; 100;</span><br><span class="line"></span><br><span class="line">区别:</span><br><span class="line">Statement: 记录SQL本身。</span><br><span class="line">ROW: 100个数据行的变化。</span><br><span class="line"></span><br><span class="line">特点:</span><br><span class="line">Statement日志量少</span><br><span class="line">ROW日志量大</span><br><span class="line"></span><br><span class="line">准确度:</span><br><span class="line">Statement记录不够准确</span><br><span class="line">ROW记录够准确。</span><br></pre></td></tr></table></figure>
<h4 id="2-binlog配置"><a href="#2-binlog配置" class="headerlink" title="2. binlog配置"></a>2. binlog配置</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>配置参数</span><br><span class="line">vim <span class="operator">/</span>etc<span class="operator">/</span>my.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">#新增加参数</span><br><span class="line">server_id<span class="operator">=</span><span class="number">51</span>                             #配置主从复制时需要用到</span><br><span class="line">log_bin<span class="operator">=</span><span class="operator">/</span>data<span class="operator">/</span>mysql_3306<span class="operator">/</span>logs<span class="operator">/</span>mysql<span class="operator">-</span>bin  #binlog日志位置</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>重启</span><br><span class="line">systemctl restart mysqld</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>检查</span><br><span class="line">ll <span class="operator">/</span>data<span class="operator">/</span>mysql_3306<span class="operator">/</span>logs<span class="operator">/</span>mysql<span class="operator">-</span>bin<span class="operator">*</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="3-binlog命令使用"><a href="#3-binlog命令使用" class="headerlink" title="3. binlog命令使用"></a>3. binlog命令使用</h4><h5 id="3-1-查看当前位于哪个binlog"><a href="#3-1-查看当前位于哪个binlog" class="headerlink" title="3.1 查看当前位于哪个binlog"></a>3.1 查看当前位于哪个binlog</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="type">binary</span> logs;</span><br><span class="line"><span class="keyword">show</span> master status;</span><br></pre></td></tr></table></figure>
<h5 id="3-2-查看当前的事件"><a href="#3-2-查看当前的事件" class="headerlink" title="3.2 查看当前的事件"></a>3.2 查看当前的事件</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> binlog events <span class="keyword">in</span> <span class="string">&#x27;mysql-bin.000001&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h5 id="3-3-刷新日志"><a href="#3-3-刷新日志" class="headerlink" title="3.3 刷新日志"></a>3.3 刷新日志</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush logs;</span><br></pre></td></tr></table></figure>
<h5 id="3-4-查看解密后的binlog日志"><a href="#3-4-查看解密后的binlog日志" class="headerlink" title="3.4 查看解密后的binlog日志"></a>3.4 查看解密后的binlog日志</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog --base64-output=decode-rows -vv  /data/mysql_3306/logs/mysql-bin.000005</span><br></pre></td></tr></table></figure>
<h5 id="3-5-查看binlog日志"><a href="#3-5-查看binlog日志" class="headerlink" title="3.5 查看binlog日志"></a>3.5 查看binlog日志</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog /data/mysql_3306/logs/mysql-bin.000001|less</span><br></pre></td></tr></table></figure>
<h5 id="3-6-binlog临时关闭方法"><a href="#3-6-binlog临时关闭方法" class="headerlink" title="3.6 binlog临时关闭方法"></a>3.6 binlog临时关闭方法</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">恢复数据时停止binlog,恢复完再开启</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> sql_log_bin<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">source <span class="operator">/</span>tmp<span class="operator">/</span>bin.sql;  #登录mysql后,导入数据库</span><br><span class="line"><span class="keyword">set</span> sql_log_bin<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="4-模拟误删除恢复"><a href="#4-模拟误删除恢复" class="headerlink" title="4 模拟误删除恢复"></a>4 模拟误删除恢复</h4><h5 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">创建或导⼊数据库之前就配置并开启了binlog</span><br><span class="line"></span><br><span class="line">一</span><br><span class="line">1.创建库</span><br><span class="line">create database linux8;</span><br><span class="line"></span><br><span class="line">2.创建表</span><br><span class="line">use linux8;</span><br><span class="line">CREATE TABLE `user` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT &#x27;id&#x27;,</span><br><span class="line">  `name` varchar(10) NOT NULL COMMENT &#x27;name&#x27;,</span><br><span class="line">  `age` tinyint(4) NOT NULL COMMENT &#x27;age&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;</span><br><span class="line"></span><br><span class="line">3.写入数据</span><br><span class="line">insert into user(name,age)</span><br><span class="line">values</span><br><span class="line">(&#x27;A&#x27;,22),</span><br><span class="line">(&#x27;B&#x27;,22),</span><br><span class="line">(&#x27;C&#x27;,22);</span><br><span class="line"></span><br><span class="line">4.查看数据</span><br><span class="line">mysql&gt; select * from linux8.user;</span><br><span class="line">+----+------+-----+</span><br><span class="line">| id | name | age |</span><br><span class="line">+----+------+-----+</span><br><span class="line">|  1 | A    |  22 |</span><br><span class="line">|  2 | B    |  22 |</span><br><span class="line">|  3 | C    |  22 |</span><br><span class="line">+----+------+-----+</span><br><span class="line"></span><br><span class="line">5.修改数据</span><br><span class="line">mysql&gt; update linux8.user set age=31;</span><br><span class="line">mysql&gt; select * from linux8.user;</span><br><span class="line">+----+------+-----+</span><br><span class="line">| id | name | age |</span><br><span class="line">+----+------+-----+</span><br><span class="line">|  1 | A    |  31 |</span><br><span class="line">|  2 | B    |  31 |</span><br><span class="line">|  3 | C    |  31 |</span><br><span class="line">+----+------+-----+</span><br><span class="line"></span><br><span class="line">二 刷新binlog</span><br><span class="line">6.追加数据</span><br><span class="line">insert into user(name,age)</span><br><span class="line">values</span><br><span class="line">(&#x27;D&#x27;,22),</span><br><span class="line">(&#x27;E&#x27;,22),</span><br><span class="line">(&#x27;F&#x27;,22);</span><br><span class="line"></span><br><span class="line">4.查看数据</span><br><span class="line">mysql&gt; select * from linux8.user;</span><br><span class="line">+----+------+-----+</span><br><span class="line">| id | name | age |</span><br><span class="line">+----+------+-----+</span><br><span class="line">|  1 | A    |  33 |</span><br><span class="line">|  2 | B    |  33 |</span><br><span class="line">|  3 | C    |  33 |</span><br><span class="line">|  4 | D    |  22 |</span><br><span class="line">|  5 | E    |  22 |</span><br><span class="line">|  6 | F    |  22 |</span><br><span class="line">+----+------+-----+</span><br><span class="line"></span><br><span class="line">模拟误删库，要求恢复到删库之前</span><br></pre></td></tr></table></figure>
<h5 id="恢复思路"><a href="#恢复思路" class="headerlink" title="恢复思路"></a>恢复思路</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>现在手里有的数据是什么?</span><br><span class="line">binlog</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>找出恢复的起点和重点</span><br><span class="line">起点: 创建数据库</span><br><span class="line">重点: 删除数据库上一条<span class="keyword">SQL</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>截取binlog</span><br><span class="line">mysqlbinlog <span class="comment">--start-position=起始点 --stop-position=终止点 /data/mysql_3306/logs/mysql-bin.000001 &gt; /tmp/bin.sql</span></span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>恢复数据</span><br><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>p123 <span class="operator">&lt;</span> <span class="operator">/</span>tmp<span class="operator">/</span>bin.sql</span><br></pre></td></tr></table></figure>
<h5 id="恢复步骤"><a href="#恢复步骤" class="headerlink" title="恢复步骤"></a>恢复步骤</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>查看当前是哪个binlog</span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> master status;</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>查看起始和终止位置点</span><br><span class="line"><span class="keyword">show</span> binlog events <span class="keyword">in</span> <span class="string">&#x27;mysql-bin.000004&#x27;</span>;</span><br><span class="line">起点: <span class="number">219</span></span><br><span class="line">重点: <span class="number">1340</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>截取binlog</span><br><span class="line">mysqlbinlog <span class="comment">--start-position=219 --stop-position=1340 /data/mysql_3306/logs/mysql-bin.000004 &gt; /tmp/bin.sql</span></span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>恢复数据</span><br><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>p123 <span class="operator">&lt;</span> <span class="operator">/</span>tmp<span class="operator">/</span>bin.sql</span><br></pre></td></tr></table></figure>
<h4 id="5-复杂情况下恢复方法"><a href="#5-复杂情况下恢复方法" class="headerlink" title="5 复杂情况下恢复方法"></a>5 复杂情况下恢复方法</h4><h5 id="5-1方法"><a href="#5-1方法" class="headerlink" title="5.1方法"></a>5.1方法</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">⽅法1:分段截取</span><br><span class="line">--start-position=xxxx    --stop-position=xxxx</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">⽅法2:时间戳截取</span><br><span class="line">  a.找起点: 建库的时间戳</span><br><span class="line">      起点posting号</span><br><span class="line">      show binlog events in &#x27;mysql-bin.000005&#x27;;</span><br><span class="line">      通过position过滤时间戳</span><br><span class="line">      mysqlbinlog --start-position=951 --stop-position=1073 mysql-bin.000005 |grep -A 1</span><br><span class="line">      &#x27;^\#\ at\ 951&#x27;</span><br><span class="line"> </span><br><span class="line">  b.找终点</span><br><span class="line">      mysql -e &quot;show binlog events in &#x27;mysql-bin.000008&#x27;&quot;</span><br><span class="line">      </span><br><span class="line">  c.截取⽇志</span><br><span class="line">      mysqlbinlog --start-datetime=&quot;2020-05-09 17:11:23&quot; --stop-datetime=&quot;2020-05-09</span><br><span class="line">      17:14:01&quot; mysql-bin.000005 mysql-bin.000006 mysql-bin.000007 mysql-bin.000008</span><br><span class="line">      &gt;/tmp/data.sql    </span><br></pre></td></tr></table></figure>
<h5 id="5-2跨多个binlog使用时间恢复"><a href="#5-2跨多个binlog使用时间恢复" class="headerlink" title="5.2跨多个binlog使用时间恢复"></a>5.2跨多个binlog使用时间恢复</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog  \</span><br><span class="line"><span class="comment">--start-datetime=&quot;2022-08-04 11:17:47&quot;  \</span></span><br><span class="line"><span class="comment">--stop-datetime=&quot;2022-08-04 11:20:17&quot;   \</span></span><br><span class="line">mysql<span class="operator">-</span>bin<span class="number">.000003</span> mysql<span class="operator">-</span>bin<span class="number">.000004</span> <span class="operator">&gt;</span> <span class="operator">/</span>tmp<span class="operator">/</span>data.sql</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="5-3-d-库名-只导出某个库的binlog事件"><a href="#5-3-d-库名-只导出某个库的binlog事件" class="headerlink" title="5.3   -d 库名  只导出某个库的binlog事件"></a>5.3   -d 库名  只导出某个库的binlog事件</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog -d laoma --start-position=4 --stop-position=2402 /data/mysql_3306/logs/mysql-bin.000006 &gt; /tmp/laoma.sql</span><br></pre></td></tr></table></figure>
<h4 id="6-基于GTID的binlog应用"><a href="#6-基于GTID的binlog应用" class="headerlink" title="6 基于GTID的binlog应用"></a>6 基于GTID的binlog应用</h4><h5 id="6-1-GTID"><a href="#6-1-GTID" class="headerlink" title="6.1 GTID"></a>6.1 GTID</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">全局唯一事务ID</span><br></pre></td></tr></table></figure>
<h5 id="6-2-事务"><a href="#6-2-事务" class="headerlink" title="6.2 事务"></a>6.2 事务</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">原子性</span><br><span class="line">一致性</span><br><span class="line">隔离性</span><br></pre></td></tr></table></figure>
<h5 id="6-3-查看GTID"><a href="#6-3-查看GTID" class="headerlink" title="6.3 查看GTID"></a>6.3 查看GTID</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%GTID%&#x27;</span>;</span><br><span class="line">server_uuid:N N事务号</span><br></pre></td></tr></table></figure>
<h5 id="6-4-配置开启GTID功能"><a href="#6-4-配置开启GTID功能" class="headerlink" title="6.4 配置开启GTID功能"></a>6.4 配置开启GTID功能</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="operator">/</span>etc<span class="operator">/</span>my.cnf </span><br><span class="line">[mysqld]</span><br><span class="line">gtid_mode<span class="operator">=</span><span class="keyword">ON</span>                  #开关</span><br><span class="line">enforce_gtid_consistency<span class="operator">=</span><span class="keyword">ON</span>   #强制GTID一致性</span><br><span class="line">log_slave_updates<span class="operator">=</span><span class="keyword">ON</span>          #强制从库更新binlog</span><br></pre></td></tr></table></figure>
<h5 id="6-5-GITD模式截取binlog"><a href="#6-5-GITD模式截取binlog" class="headerlink" title="6.5 GITD模式截取binlog"></a>6.5 GITD模式截取binlog</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog --skip-gtids --include-gtids=<span class="string">&#x27;7336e9ba-12f5-11ed-bc59-000c29d81fef:1-3&#x27;</span> /data/mysql_3306/logs/mysql-bin.000008 &gt;/tmp/gtid_skip.sql</span><br></pre></td></tr></table></figure>
<h4 id="7-binlog日志清理"><a href="#7-binlog日志清理" class="headerlink" title="7 binlog日志清理"></a>7 binlog日志清理</h4><h5 id="7-1手动刷新"><a href="#7-1手动刷新" class="headerlink" title="7.1手动刷新"></a>7.1手动刷新</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">flush logs;</span><br><span class="line">shell# mysqladmin flush<span class="operator">-</span>logs</span><br><span class="line">shell# mysql <span class="operator">-</span>e &quot;flush logs&quot;</span><br><span class="line">shell# mysqldump <span class="operator">-</span>F</span><br></pre></td></tr></table></figure>
<h5 id="7-2-默认大小"><a href="#7-2-默认大小" class="headerlink" title="7.2 默认大小"></a>7.2 默认大小</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@max</span>_binlog_size;  查看</span><br><span class="line">默认<span class="number">1</span>个G大小,超过了自动刷新</span><br><span class="line"><span class="keyword">set</span> max_binlog_size<span class="operator">=</span>字节;   设置</span><br></pre></td></tr></table></figure>
<h5 id="7-3-日志删除"><a href="#7-3-日志删除" class="headerlink" title="7.3 日志删除"></a>7.3 日志删除</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">默认不删除</span><br><span class="line">设置自动过期时间:</span><br><span class="line"><span class="keyword">select</span> @<span class="variable">@expire</span>_logs_days;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">GLOBAL</span> expire_logs_days<span class="operator">=</span><span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">手工清理:</span><br><span class="line">PURGE <span class="type">BINARY</span> LOGS <span class="keyword">TO</span> <span class="string">&#x27;mysql-bin.000010&#x27;</span>;</span><br><span class="line">PURGE <span class="type">BINARY</span> LOGS BEFORE <span class="string">&#x27;2022-08-04 22:46:26&#x27;</span>;</span><br><span class="line"></span><br><span class="line">重置binlog:</span><br><span class="line">reset master;</span><br></pre></td></tr></table></figure>
<h2 id="第5章-MySQL备份恢复"><a href="#第5章-MySQL备份恢复" class="headerlink" title="第5章 MySQL备份恢复"></a>第5章 MySQL备份恢复</h2><h3 id="一-备份理论"><a href="#一-备份理论" class="headerlink" title="一 备份理论"></a>一 备份理论</h3><h4 id="1-MySQL备份方式"><a href="#1-MySQL备份方式" class="headerlink" title="1.MySQL备份方式"></a>1.MySQL备份方式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">逻辑备份 mysqldump  备份的是SQL语句</span><br><span class="line">物理备份 Xtrabackup 直接备份数据目录的文件</span><br></pre></td></tr></table></figure>
<h4 id="2-逻辑备份和物理备份区别"><a href="#2-逻辑备份和物理备份区别" class="headerlink" title="2.逻辑备份和物理备份区别"></a>2.逻辑备份和物理备份区别</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysqldump:</span><br><span class="line">备份出来的文件可以直接查看</span><br><span class="line">如果数据量较大,恢复速度较慢</span><br><span class="line">只能全备</span><br><span class="line">100G以内</span><br><span class="line"></span><br><span class="line">Xtrabackup:</span><br><span class="line">直接备份的物理文件,备份速度和恢复速度都很快</span><br><span class="line">备份出来的文件不可阅读</span><br><span class="line">支持全备和增量备份</span><br><span class="line">超过100G</span><br></pre></td></tr></table></figure>
<h3 id="二-mysqldump工具使用"><a href="#二-mysqldump工具使用" class="headerlink" title="二 mysqldump工具使用"></a>二 mysqldump工具使用</h3><h4 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1.介绍"></a>1.介绍</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">数据逻辑备份工具</span><br><span class="line">MySQL 自带的客户端命令</span><br><span class="line">可以实现远程和本地备份</span><br></pre></td></tr></table></figure>
<h4 id="2-参数"><a href="#2-参数" class="headerlink" title="2.参数"></a>2.参数</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#连接参数</span><br><span class="line">-u 用户名</span><br><span class="line">-p 密码</span><br><span class="line">-S 本地socket文件路径</span><br><span class="line"></span><br><span class="line">#socket文件解释</span><br><span class="line">1.socket文件如果配置里没有设置,则默认为/tmp/mysql.sock</span><br><span class="line">2.mysql客户端连接的时候,如果不指定,默认也是找/tmp/mysql.sock</span><br><span class="line">3.mysql -uroot -p123如果不接IP,就认为你是链接本地的mysql</span><br><span class="line">4.配置解释:当你使用mysql自己的客户端连接的时候,读取以下标签内的配置</span><br><span class="line">[mysql]</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">#备份参数</span><br><span class="line">-A  导出所有的库</span><br><span class="line">-B  导出单库或多库</span><br><span class="line">--master-data=2		  标记全备的时候位于binlog哪个位置,=2这一行是个注释,固定为22行</span><br><span class="line">--single-transaction  对于InnoDB表,通过快照备份表数据,不锁表备份,可以理解为热备</span><br><span class="line">-R -E --triggers      备份特殊对象使用</span><br></pre></td></tr></table></figure>
<h4 id="3-备份命令"><a href="#3-备份命令" class="headerlink" title="3 备份命令"></a>3 备份命令</h4><h5 id="3-1全备命令"><a href="#3-1全备命令" class="headerlink" title="3.1全备命令"></a>3.1全备命令</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p123 -A --master-data=2 --single-transaction -R -E --triggers &gt; /backup/full_$(<span class="built_in">date</span> +%F).sql</span><br></pre></td></tr></table></figure>
<h5 id="3-2备份单个库或多个库"><a href="#3-2备份单个库或多个库" class="headerlink" title="3.2备份单个库或多个库"></a>3.2备份单个库或多个库</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p123 -B 库名 --master-data=2 --single-transaction -R -E --triggers &gt; /backup/linux7_$(<span class="built_in">date</span> +%F).sql</span><br><span class="line"></span><br><span class="line">mysqldump -uroot -p123 -B 库名 库名 --master-data=2 --single-transaction -R -E --triggers &gt; /backup/linux7_$(<span class="built_in">date</span> +%F).sql</span><br></pre></td></tr></table></figure>
<h5 id="3-3备份单个表或多个表"><a href="#3-3备份单个表或多个表" class="headerlink" title="3.3备份单个表或多个表"></a>3.3备份单个表或多个表</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p123 库名 表名 --master-data=2 --single-transaction -R -E --triggers &gt; /backup/linux7_$(<span class="built_in">date</span> +%F).sql</span><br><span class="line"></span><br><span class="line">mysqldump -uroot -p123 库名 表名 表名 --master-data=2 --single-transaction -R -E --triggers &gt; /backup/linux7_$(<span class="built_in">date</span> +%F).sql</span><br></pre></td></tr></table></figure>
<h5 id="3-4远程备份"><a href="#3-4远程备份" class="headerlink" title="3.4远程备份"></a>3.4远程备份</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -uroot -p123 -h10.0.0.51 -A --master-data=2 --single-transaction -R -E --triggers &gt; /backup/full_$(<span class="built_in">date</span> +%F).sql</span><br></pre></td></tr></table></figure>
<h4 id="4-mysqldump分库分表备份脚本"><a href="#4-mysqldump分库分表备份脚本" class="headerlink" title="4 mysqldump分库分表备份脚本"></a>4 mysqldump分库分表备份脚本</h4><h5 id="4-1思路"><a href="#4-1思路" class="headerlink" title="4.1思路"></a>4.1思路</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">双层<span class="keyword">for</span>循环</span><br><span class="line">第一层<span class="keyword">for</span>循环所有的库</span><br><span class="line">第二层<span class="keyword">for</span>循环库下所有的表</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ku <span class="keyword">in</span> $(查询库的语句)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> biao <span class="keyword">in</span> $(查询库里的表)</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">      mysqldump -uroot -p123 -h127.0.0.1 <span class="variable">$ku</span> <span class="variable">$biao</span> --master-data=2 --single-transaction -R -E --triggers &gt; /backup/<span class="variable">$ku</span>/<span class="variable">$biao</span>.sql</span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="4-2脚本"><a href="#4-2脚本" class="headerlink" title="4.2脚本"></a>4.2脚本</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> ku <span class="keyword">in</span> $(mysql -N -e <span class="string">&#x27;show databases;&#x27;</span>|egrep -v <span class="string">&#x27;mysql|schema|sys&#x27;</span>)</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  <span class="built_in">mkdir</span> /backup/$(<span class="built_in">date</span> +%F)/<span class="variable">$ku</span>/ -p</span><br><span class="line">  <span class="keyword">for</span> biao <span class="keyword">in</span> $(mysql -N -e <span class="string">&quot;show tables from <span class="variable">$ku</span>;&quot;</span>)</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">      mysqldump -h127.0.0.1 <span class="variable">$ku</span> <span class="variable">$biao</span> --master-data=2 --single-transaction -R -E --triggers &gt; /backup/$(<span class="built_in">date</span> +%F)/<span class="variable">$ku</span>/<span class="variable">$biao</span>.sql</span><br><span class="line">  <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="4-3命令行带密码警告，解决方法"><a href="#4-3命令行带密码警告，解决方法" class="headerlink" title="4.3命令行带密码警告，解决方法"></a>4.3命令行带密码警告，解决方法</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">可以把账号密码写进配置文件里,这样就不会出现命令警告了</span><br><span class="line">vim <span class="operator">/</span>etc<span class="operator">/</span>my.cnf</span><br><span class="line">[client]</span><br><span class="line"><span class="keyword">user</span><span class="operator">=</span>root</span><br><span class="line">password<span class="operator">=</span><span class="number">123</span></span><br></pre></td></tr></table></figure>
<h3 id="三-Xtrabackup"><a href="#三-Xtrabackup" class="headerlink" title="三 Xtrabackup"></a>三 Xtrabackup</h3><h5 id="1-Xtrabackup介绍"><a href="#1-Xtrabackup介绍" class="headerlink" title="1.Xtrabackup介绍"></a>1.Xtrabackup介绍</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">percona公司研发 </span><br><span class="line">  1）xtrabackup 是专门用来备份InnoDB表的，和mysql server没有交互；</span><br><span class="line">  2）innobackupex 是一个封装xtrabackup的Perl脚本，支持同时备份innodb和myisam，但在对myisam备份时需要加一个全局的读锁。</span><br><span class="line">  3）xbcrypt 加密解密备份工具</span><br><span class="line">  4）xbstream 流传打包传输工具，类似tar</span><br><span class="line">8.0之前，2.4.x   </span><br><span class="line">8.0之后，8.0</span><br><span class="line">物理备份工具，类似于cp文件。</span><br><span class="line">支持：全备和增量备份</span><br></pre></td></tr></table></figure>
<h5 id="2-Xtrabackup安装"><a href="#2-Xtrabackup安装" class="headerlink" title="2.Xtrabackup安装"></a>2.Xtrabackup安装</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum -y install perl perl-devel libaio libaio-devel perl-Time-HiRes perl-DBD-MySQL libev</span><br><span class="line"></span><br><span class="line">wget https://www.percona.com/downloads/XtraBackup/Percona-XtraBackup-2.4.12/binary/redhat/7/x86_64/percona-xtrabackup-24-2.4.12-1.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">wget https://www.percona.com/downloads/XtraBackup/Percona-XtraBackup-2.4.9/binary/redhat/6/x86_64/Percona-XtraBackup-2.4.9-ra467167cdd4-el6-x86_64-bundle.tar</span><br><span class="line"></span><br><span class="line">yum -y localinstall percona-xtrabackup-24-2.4.12-1.el7.x86_64.rpm</span><br><span class="line">官网已经找不到2.4版本的包了，需要寻找其他途径</span><br></pre></td></tr></table></figure>
<h5 id="3-Xtrabackup全备数据"><a href="#3-Xtrabackup全备数据" class="headerlink" title="3. Xtrabackup全备数据"></a>3. Xtrabackup全备数据</h5><h6 id="3-1全量备份命令"><a href="#3-1全量备份命令" class="headerlink" title="3.1全量备份命令"></a>3.1全量备份命令</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#添加socket配置</span><br><span class="line">[client]</span><br><span class="line">user=root</span><br><span class="line">password=123</span><br><span class="line">socket=/tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">#全备命令</span><br><span class="line">innobackupex -uroot -p123 -S /tmp/mysql.sock /backup/</span><br><span class="line"></span><br><span class="line">#自定义目录名备份</span><br><span class="line">innobackupex -uroot -p123 -S /tmp/mysql.sock --no-timestamp /backup/full_$(date +%F)</span><br></pre></td></tr></table></figure>
<h5 id="3-2相关文件"><a href="#3-2相关文件" class="headerlink" title="3.2相关文件"></a>3.2相关文件</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">xtrabackup_binlog_info:			备份时位于binlog位置点</span><br><span class="line">xtrabackup_checkpoints:     	备份期间的一些校验信息</span><br><span class="line"><span class="comment">--------------------------------------------------</span></span><br><span class="line">backup_type <span class="operator">=</span> <span class="keyword">full</span><span class="operator">-</span>backuped		全备</span><br><span class="line">from_lsn <span class="operator">=</span> <span class="number">0</span>					增量备份需要关心</span><br><span class="line">to_lsn <span class="operator">=</span> <span class="number">2704642</span>				最近的内存数据落地到磁盘上的LSN号</span><br><span class="line">last_lsn <span class="operator">=</span> <span class="number">2704651</span>				xtrabackup_logfile</span><br><span class="line"><span class="comment">--------------------------------------------------</span></span><br><span class="line">xtrabackup_info:			    备份命令的一些信息</span><br><span class="line">xtrabackup_logfile:             备份期间变化的数据,还没有写入到磁盘里</span><br></pre></td></tr></table></figure>
<h5 id="3-3恢复命令"><a href="#3-3恢复命令" class="headerlink" title="3.3恢复命令"></a>3.3恢复命令</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">第<span class="number">1</span>步: 准备数据</span><br><span class="line">     innobackupex <span class="comment">--apply-log /backup/2022-01-13_14-51-59</span></span><br><span class="line"></span><br><span class="line">第<span class="number">2</span>步: 恢复数据<span class="operator">-</span>任选一个方法即可</span><br><span class="line">     方法<span class="number">1</span>): 使用命令复制全备文件到数据目录</span><br><span class="line">            innobackupex <span class="comment">--copy-back /backup/2022-01-13_14-51-59/</span></span><br><span class="line">            innobackupex <span class="comment">--move-back /backup/2022-01-13_14-51-59/</span></span><br><span class="line">     方法<span class="number">2</span>): 修改配置文件,数据目录指向备份文件目录</span><br><span class="line">     方法<span class="number">3</span>): 创建备份目录的软链接到数据目录</span><br><span class="line">            mkdir <span class="operator">/</span>backup<span class="operator">/</span><span class="number">2022</span><span class="number">-01</span><span class="number">-13</span>_14<span class="number">-51</span><span class="number">-59</span><span class="operator">/</span>logs</span><br><span class="line">            touch <span class="operator">/</span>backup<span class="operator">/</span><span class="number">2022</span><span class="number">-01</span><span class="number">-13</span>_14<span class="number">-51</span><span class="number">-59</span><span class="operator">/</span>logs<span class="operator">/</span>mysql.err</span><br><span class="line">            chown <span class="operator">-</span>R mysql:mysql <span class="operator">/</span>backup<span class="operator">/</span><span class="number">2022</span><span class="number">-01</span><span class="number">-13</span>_14<span class="number">-51</span><span class="number">-59</span><span class="operator">/</span></span><br><span class="line">            ln <span class="operator">-</span>s <span class="operator">/</span>backup<span class="operator">/</span><span class="number">2022</span><span class="number">-01</span><span class="number">-13</span>_14<span class="number">-51</span><span class="number">-59</span><span class="operator">/</span> <span class="operator">/</span>data<span class="operator">/</span>mysql_3306 </span><br><span class="line"></span><br><span class="line">第<span class="number">3</span>步: 小坑<span class="operator">-</span>恢复数据后记得更改权限</span><br><span class="line">      <span class="number">1</span>)备份恢复的时候不会把日志目录一起备份，比如错误日志和Binlog日志，恢复完成后需要手动创建</span><br><span class="line">      <span class="number">2</span>)恢复后数据目录的用户权限都是root，需要手动更改权限</span><br><span class="line">      mkdir <span class="operator">/</span>data<span class="operator">/</span>mysql_3306<span class="operator">/</span>logs<span class="operator">/</span></span><br><span class="line">      touch <span class="operator">/</span>data<span class="operator">/</span>mysql_3306<span class="operator">/</span>logs<span class="operator">/</span>mysql.err</span><br><span class="line">      chown <span class="operator">-</span>R mysql:mysql <span class="operator">/</span>data<span class="operator">/</span>mysql_3306</span><br><span class="line">      systemctl <span class="keyword">start</span> mysqld</span><br></pre></td></tr></table></figure>
<h4 id="4-Xtrabackup增量备份数据"><a href="#4-Xtrabackup增量备份数据" class="headerlink" title="4 Xtrabackup增量备份数据"></a>4 Xtrabackup增量备份数据</h4><h5 id="4-1介绍"><a href="#4-1介绍" class="headerlink" title="4.1介绍"></a>4.1介绍</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">自带的功能。</span><br><span class="line">每次增量一般是将最近一次备份作为参照物。</span><br><span class="line">自动读取参照物cat xtrabackup_checkpoints中to_lsn值，与当前CKPT的LSN对比，备份变化过page。</span><br><span class="line">备份期间新的数据变化，通过redo自动备份。</span><br><span class="line">恢复数据时，需要把所有需要的增量合并到<span class="keyword">FULL</span>中。无法通过增量单独恢复数据，依赖与全备。</span><br></pre></td></tr></table></figure>
<h5 id="4-2实验步骤"><a href="#4-2实验步骤" class="headerlink" title="4.2实验步骤"></a>4.2实验步骤</h5><h6 id="实验环境"><a href="#实验环境" class="headerlink" title="实验环境"></a>实验环境</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">FULL(周日)+inc1(周一)+inc2(周二)+inc3(周三)</span><br><span class="line">第1步: 实验数据准备</span><br><span class="line">create database xbk charset utf8mb4;</span><br><span class="line">use xbk</span><br><span class="line">create table full (<span class="built_in">id</span> int);</span><br><span class="line">insert into full values(1),(2),(3);</span><br><span class="line"></span><br><span class="line">第2步: 模拟周日 23:00 全备</span><br><span class="line">innobackupex -uroot -p123 -S /tmp/mysql.sock --no-timestamp /backup/full_$(<span class="built_in">date</span> +%F)</span><br><span class="line"></span><br><span class="line">第3步: 模拟周一白天数据变化 </span><br><span class="line">use xbk</span><br><span class="line">create table inc1 (<span class="built_in">id</span> int);</span><br><span class="line">insert into  inc1 values(1),(2),(3);</span><br><span class="line"></span><br><span class="line">第4步: 第一次增量备份</span><br><span class="line">innobackupex -uroot -p123 -S /tmp/mysql.sock --no-timestamp --incremental --incremental-basedir=/backup/full_2022-01-13  /backup/inc1_$(<span class="built_in">date</span> +%F)</span><br><span class="line"></span><br><span class="line">第5步: 模拟周二白天数据变化 </span><br><span class="line">use xbk</span><br><span class="line">create table inc2 (<span class="built_in">id</span> int);</span><br><span class="line">insert into  inc2 values(1),(2),(3);</span><br><span class="line"></span><br><span class="line">第6步: 第二次增量备份</span><br><span class="line">innobackupex -uroot -p123 -S /tmp/mysql.sock --no-timestamp --incremental --incremental-basedir=/backup/inc1_2022-01-13  /backup/inc2_$(<span class="built_in">date</span> +%F)</span><br><span class="line"></span><br><span class="line">第7步: 模拟周三白天数据变化 </span><br><span class="line">use xbk</span><br><span class="line">create table inc3 (<span class="built_in">id</span> int);</span><br><span class="line">insert into  inc3 values(1),(2),(3);</span><br><span class="line"></span><br><span class="line">第8步: 第三次增量备份</span><br><span class="line">innobackupex -uroot -p123 -S /tmp/mysql.sock --no-timestamp --incremental --incremental-basedir=/backup/inc2_2022-01-13  /backup/inc3_$(<span class="built_in">date</span> +%F)</span><br><span class="line"></span><br><span class="line">第9步: 模拟周四白天数据变化</span><br><span class="line">use xbk</span><br><span class="line">create table inc4(<span class="built_in">id</span> int);</span><br><span class="line">insert into  inc4 values(1),(2),(3);</span><br><span class="line">commit;</span><br><span class="line"></span><br><span class="line">第10步: 周四下午出现数据损坏。如何恢复到误删除之前。</span><br><span class="line">pkill mysqld</span><br><span class="line"><span class="built_in">rm</span> -rf /data/mysql_3306/*</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h6 id="恢复步骤-1"><a href="#恢复步骤-1" class="headerlink" title="恢复步骤"></a>恢复步骤</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">第11步: 截取binlog位置点</span><br><span class="line">全备-增量1-增量2-增量3-binlog</span><br><span class="line"></span><br><span class="line">备份的数据:</span><br><span class="line">全备-增量1-增量2-增量3</span><br><span class="line"></span><br><span class="line">binlog起始和终止点</span><br><span class="line">起始点: </span><br><span class="line"><span class="built_in">cat</span> /backup/inc3_2022-01-13/xtrabackup_binlog_info </span><br><span class="line">mysql-bin.000001	21105729</span><br><span class="line"></span><br><span class="line">终止点:</span><br><span class="line">at 21106154</span><br><span class="line"></span><br><span class="line">截取命令:</span><br><span class="line">mysqlbinlog --start-position=21105729 --stop-position=21106154 /opt/logs/mysql-bin.000001 &gt; /tmp/backup.sql </span><br><span class="line"></span><br><span class="line">第12步: 处理全备,将临时文件整合到磁盘里</span><br><span class="line">innobackupex --apply-log --redo-only /backup/full_2022-01-13/</span><br><span class="line"></span><br><span class="line">第13步: inc1合并到full中，并且prepare</span><br><span class="line">innobackupex --apply-log --redo-only --incremental-dir=inc1_2022-01-13 full_2022-01-13</span><br><span class="line"></span><br><span class="line">检验合并结果:</span><br><span class="line"><span class="built_in">cat</span> /backup/full_2022-01-13/xtrabackup_checkpoints |grep <span class="string">&quot;to_lsn&quot;</span></span><br><span class="line"><span class="built_in">cat</span> /backup/inc1_2022-01-13/xtrabackup_checkpoints |grep <span class="string">&quot;to_lsn&quot;</span></span><br><span class="line"></span><br><span class="line">第14步: inc2合并到full中，并且prepare</span><br><span class="line">innobackupex --apply-log --redo-only --incremental-dir=inc2_2022-01-13 full_2022-01-13</span><br><span class="line"></span><br><span class="line">检验合并结果:</span><br><span class="line"><span class="built_in">cat</span> /backup/full_2022-01-13/xtrabackup_checkpoints |grep <span class="string">&quot;to_lsn&quot;</span></span><br><span class="line"><span class="built_in">cat</span> /backup/inc2_2022-01-13/xtrabackup_checkpoints |grep <span class="string">&quot;to_lsn&quot;</span></span><br><span class="line"></span><br><span class="line">第15步: inc3合并到full中，并且prepare</span><br><span class="line">innobackupex --apply-log --redo-only --incremental-dir=inc3_2022-01-13 full_2022-01-13</span><br><span class="line"></span><br><span class="line">检验合并结果:</span><br><span class="line"><span class="built_in">cat</span> /backup/full_2022-01-13/xtrabackup_checkpoints |grep <span class="string">&quot;to_lsn&quot;</span></span><br><span class="line"><span class="built_in">cat</span> /backup/inc3_2022-01-13/xtrabackup_checkpoints |grep <span class="string">&quot;to_lsn&quot;</span></span><br><span class="line"></span><br><span class="line">第16步:将合并后全备再次prepare</span><br><span class="line">innobackupex --apply-log  /backup/full_2022-01-13</span><br><span class="line"></span><br><span class="line">第17步:恢复数据</span><br><span class="line">innobackupex --copy-back /backup/full_2022-01-13</span><br><span class="line"><span class="built_in">mkdir</span> /data/mysql_3306/logs/</span><br><span class="line"><span class="built_in">touch</span> /data/mysql_3306/logs/mysql.err</span><br><span class="line"><span class="built_in">chown</span> -R mysql:mysql /data/mysql_3306</span><br><span class="line">systemctl start mysqld</span><br><span class="line">mysql -uroot -p123 &lt; /backup/backup.sql</span><br><span class="line"></span><br><span class="line">第18步:检查数据</span><br><span class="line">t100w</span><br><span class="line">xbk inc1 inc2 inc3 inc4</span><br><span class="line"></span><br><span class="line">第19步:立刻做一次全备</span><br><span class="line">innobackupex -uroot -p123 -S /tmp/mysql.sock --no-timestamp /backup/full_OK_$(<span class="built_in">date</span> +%F)</span><br></pre></td></tr></table></figure>
<h2 id="第6章-MySQL主从复制"><a href="#第6章-MySQL主从复制" class="headerlink" title="第6章 MySQL主从复制"></a>第6章 MySQL主从复制</h2><h3 id="一-主从复制流程原理"><a href="#一-主从复制流程原理" class="headerlink" title="一 主从复制流程原理"></a>一 主从复制流程原理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">主从复制，分为主库和从库。</span><br><span class="line">先从从库讲起；</span><br><span class="line">从库有两个线程，IO线程和SQL线程，</span><br><span class="line">  IO主要作用：连接主库DUMP线程,请求Master日志、接收Master日志、存储本地中继日志（relay-log）。</span><br><span class="line">  SQL主要作用：回放 中继日志中的语句;</span><br><span class="line">主库只有一个DUMP线程，</span><br><span class="line">  DUMP作用：负责接收slave请求和监控主库binlog并发送给slave。</span><br><span class="line">IO线程：</span><br><span class="line">  1.IO线程先读取master.info文件</span><br><span class="line">  2.根据里面记录的信息向主库连接</span><br><span class="line">  3.主库再创建DUMP线程</span><br><span class="line">  4.IO根据master.info向DUMP请求日志</span><br><span class="line">  5.主库DUMP使用网络发送日志给IO</span><br><span class="line">  6.IO接收到后储存到中继日志中</span><br><span class="line">  以上步骤就是IO的循环工作线程</span><br><span class="line">SQL:</span><br><span class="line">  1.SQL先读取relay.info，确认自己回放到了哪里</span><br><span class="line">  2.再去中继日志中找到下一条回放</span><br><span class="line">  3.再更新relay.info</span><br><span class="line">  以上步骤就是SQL的循环工作线程</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="二-MySQL主从复制部署"><a href="#二-MySQL主从复制部署" class="headerlink" title="二 MySQL主从复制部署"></a>二 MySQL主从复制部署</h3><h4 id="1-主库环境"><a href="#1-主库环境" class="headerlink" title="1.主库环境"></a>1.主库环境</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop mysqld</span><br><span class="line"><span class="built_in">rm</span> -rf /data/mysql_3306/*</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/my.cnf &lt;&lt; <span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">[mysqld]</span><br><span class="line">port=3306</span><br><span class="line">user=mysql</span><br><span class="line">basedir=/opt/mysql</span><br><span class="line">datadir=/data/mysql_3306</span><br><span class="line">socket=/tmp/mysql_3306.sock</span><br><span class="line">server_id=51</span><br><span class="line">log_bin=/data/binglog/mysql-bin</span><br><span class="line">     </span><br><span class="line">[mysql]</span><br><span class="line">socket=/tmp/mysql_3306.sock</span><br><span class="line">EOF</span><br><span class="line"><span class="built_in">mkdir</span> -p /data/binglog/</span><br><span class="line"><span class="built_in">chown</span> -R mysql:mysql /data/binglog/</span><br><span class="line">mysqld --initialize-insecure --user=mysql --basedir=/opt/mysql --datadir=/data/mysql_3306/</span><br><span class="line">systemctl start mysqld</span><br><span class="line">mysqladmin password <span class="string">&#x27;123&#x27;</span> -S /tmp/mysql_3306.sock </span><br><span class="line">mysql -uroot -p123</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="2-从库环境"><a href="#2-从库环境" class="headerlink" title="2.从库环境"></a>2.从库环境</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">scp 10.0.0.51:/opt/mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz /opt/</span><br><span class="line"><span class="built_in">cd</span> /opt/</span><br><span class="line">tar zxf mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz -C /opt/</span><br><span class="line"><span class="built_in">mv</span> mysql-5.7.28-linux-glibc2.12-x86_64 mysql-5.7.28</span><br><span class="line"><span class="built_in">ln</span> -s mysql-5.7.28 mysql</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;PATH=$PATH:/opt/mysql/bin&#x27;</span> &gt;&gt; /etc/profile</span><br><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">mysql -V</span><br><span class="line">rpm -qa|grep mariadb</span><br><span class="line">yum remove mariadb-libs -y</span><br><span class="line"><span class="built_in">rm</span> -rf /etc/my.cnf</span><br><span class="line">yum install -y libaio-devel</span><br><span class="line"><span class="built_in">mkdir</span> /data/mysql_3306/ -p</span><br><span class="line">useradd -s /sbin/nologin -M mysql</span><br><span class="line"><span class="built_in">chown</span> -R mysql.mysql /data/</span><br><span class="line"><span class="built_in">chown</span> -R mysql.mysql /opt/mysql*</span><br><span class="line">mysqld --initialize-insecure --user=mysql --basedir=/opt/mysql --datadir=/data/mysql_3306/</span><br><span class="line"><span class="built_in">cat</span> &gt; /etc/my.cnf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[mysqld]</span></span><br><span class="line"><span class="string">port=3306</span></span><br><span class="line"><span class="string">user=mysql</span></span><br><span class="line"><span class="string">basedir=/opt/mysql</span></span><br><span class="line"><span class="string">datadir=/data/mysql_3306</span></span><br><span class="line"><span class="string">socket=/tmp/mysql_3306.sock</span></span><br><span class="line"><span class="string">server_id=52</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[mysql]</span></span><br><span class="line"><span class="string">socket=/tmp/mysql_3306.sock</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="built_in">cp</span> /opt/mysql/support-files/mysql.server  /etc/init.d/mysqld</span><br><span class="line">chkconfig --add mysqld</span><br><span class="line">systemctl start mysqld</span><br><span class="line">netstat -lntup|grep 3306</span><br><span class="line">mysqladmin password <span class="string">&#x27;123&#x27;</span> -S /tmp/mysql_3306.sock </span><br><span class="line">mysql -uroot -p123</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="3-MySQL主从复制配置步骤"><a href="#3-MySQL主从复制配置步骤" class="headerlink" title="3 MySQL主从复制配置步骤"></a>3 MySQL主从复制配置步骤</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">1.主库创建复制账号</span><br><span class="line">grant replication slave on *.* to repl@<span class="string">&#x27;10.0.0.%&#x27;</span> identified by <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line">select user,host from mysql.user;</span><br><span class="line"></span><br><span class="line">2.主库全备数据</span><br><span class="line">mysql -uroot -p123 &lt; school.sql</span><br><span class="line">mysqldump -uroot -p123 -S /tmp/mysql_3306.sock -A --master-data=2 --single-transaction &gt; /tmp/full.sql</span><br><span class="line"></span><br><span class="line">3.主库将全备发送给从库,再导入一个数据库</span><br><span class="line">scp /tmp/full.sql 10.0.0.52:/opt/</span><br><span class="line">mysql -uroot -p123 &lt; world.sql</span><br><span class="line"></span><br><span class="line">4.从库导入主库的全备数据</span><br><span class="line">mysql -uroot -p123 &lt; /opt/full.sql</span><br><span class="line"></span><br><span class="line">5.从库查看备份位置点</span><br><span class="line">sed -n <span class="string">&#x27;22p&#x27;</span> /opt/full.sql</span><br><span class="line"></span><br><span class="line">6.从库执行主从复制命令</span><br><span class="line">CHANGE MASTER TO</span><br><span class="line">MASTER_HOST=<span class="string">&#x27;10.0.0.51&#x27;</span>,</span><br><span class="line">MASTER_USER=<span class="string">&#x27;repl&#x27;</span>,</span><br><span class="line">MASTER_PASSWORD=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">MASTER_PORT=3306,</span><br><span class="line">MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000003&#x27;</span>,</span><br><span class="line">MASTER_LOG_POS=704,</span><br><span class="line">MASTER_CONNECT_RETRY=10;</span><br><span class="line"></span><br><span class="line">7.从库开启复制</span><br><span class="line">start slave;</span><br><span class="line"></span><br><span class="line">8.从库检查复制状态</span><br><span class="line">show slave status\G</span><br><span class="line">----------------------</span><br><span class="line">Slave_IO_Running: Yes</span><br><span class="line">Slave_SQL_Running: Yes</span><br><span class="line">----------------------</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="4-主从复制故障"><a href="#4-主从复制故障" class="headerlink" title="4.主从复制故障"></a>4.主从复制故障</h4><h5 id="4-1-IO线程故障"><a href="#4-1-IO线程故障" class="headerlink" title="4.1 IO线程故障"></a>4.1 IO线程故障</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Slave_IO_Running: Connecting</span><br><span class="line">Slave_SQL_Running: Yes</span><br><span class="line"></span><br><span class="line">Last_IO_Error: error connecting to master &#x27;repl@10.0.0.51:3306&#x27; - retry-time: 10  retries: 3</span><br><span class="line"></span><br><span class="line">原因：</span><br><span class="line">账号密码写错了</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Slave_IO_Running: No</span><br><span class="line">Slave_SQL_Running: Yes</span><br><span class="line"></span><br><span class="line">Last_IO_Error: Got fatal error 1236 from master when reading data from binary log: &#x27;Could not find first log file name in binary log index file</span><br><span class="line"></span><br><span class="line">Last_IO_Error: Got fatal error 1236 from master when reading data from binary log: &#x27;Client requested master to start replication from position &gt; file size&#x27;</span><br><span class="line"></span><br><span class="line">原因:</span><br><span class="line">从库请求的binlog在主库上不存在</span><br><span class="line">从库请求的binlog位置点大于主库最新的</span><br></pre></td></tr></table></figure>
<h5 id="4-2-SQL线程故障"><a href="#4-2-SQL线程故障" class="headerlink" title="4.2 SQL线程故障"></a>4.2 SQL线程故障</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Slave_IO_Running: Yes</span><br><span class="line">Slave_SQL_Running: No</span><br><span class="line"></span><br><span class="line">Last_Error: Error &#x27;Can&#x27;t create database &#x27;linux8&#x27;; database exists&#x27; on query. Default database: &#x27;linux8&#x27;. Query: &#x27;create database linux8&#x27;</span><br><span class="line"></span><br><span class="line">原因:</span><br><span class="line">从库执行SQL语句冲突报错</span><br><span class="line"></span><br><span class="line">解决:</span><br><span class="line">以主库为准,从库修正或删除问题数据</span><br><span class="line">从库设为只读,不允许手动写入和修改,这样主库能执行，从库肯定能执行</span><br><span class="line">如果错误的太多了,建议从库干掉,重做</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">John Doe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/posts/9520183a.html">http://example.com/posts/9520183a.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Hexo</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/439fff01.html"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Hello Worldsdasdas</div></div></a></div><div class="next-post pull-right"><a href="/posts/d87f7e0c.html"><img class="next-cover" src="https://typora-1257900361.cos.ap-guangzhou.myqcloud.com/images/image-20220921160816077.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">test</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">John Doe</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#day61-mysql"><span class="toc-number">1.</span> <span class="toc-text">day61-mysql</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC1%E7%AB%A0-MySQL%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="toc-number">1.1.</span> <span class="toc-text">第1章 MySQL安装部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-MySQL%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.1.</span> <span class="toc-text">一 MySQL介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-MySQL%E5%92%8CMariadb%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">1.MySQL和Mariadb的关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E7%89%88%E6%9C%AC%E9%80%89%E6%8B%A9"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">2.版本选择</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-MySQL%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2"><span class="toc-number">1.1.2.</span> <span class="toc-text">二  MySQL安装部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E8%A7%A3%E5%8E%8B%E5%B9%B6%E5%88%9B%E5%BB%BA%E8%BD%AF%E9%93%BE%E6%8E%A5"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">1.解压并创建软链接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">2.配置环境变量</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%B8%85%E7%90%86%E5%8E%86%E5%8F%B2%E9%81%97%E7%95%99%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">3.清理历史遗留环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%AE%89%E8%A3%85mysql%E4%BE%9D%E8%B5%96%E5%8C%85"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">4.安装mysql依赖包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%88%9B%E5%BB%BAmysql%E6%99%AE%E9%80%9A%E7%94%A8%E6%88%B7%E5%B9%B6%E6%8E%88%E6%9D%83"><span class="toc-number">1.1.2.5.</span> <span class="toc-text">5.创建mysql普通用户并授权</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93data%E7%9B%AE%E5%BD%95"><span class="toc-number">1.1.2.6.</span> <span class="toc-text">6.初始化数据库data目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E7%BC%96%E8%BE%91mysql%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.2.7.</span> <span class="toc-text">7.编辑mysql配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E5%87%86%E5%A4%87%E5%90%AF%E5%8A%A8systemd%E8%84%9A%E6%9C%AC%E5%B9%B6%E5%90%AF%E5%8A%A8%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.1.2.8.</span> <span class="toc-text">8.准备启动systemd脚本并启动数据库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E7%99%BB%E5%BD%95%E6%B5%8B%E8%AF%95"><span class="toc-number">1.1.2.9.</span> <span class="toc-text">9.登录测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-MySQL%E5%90%AF%E5%8A%A8%E5%92%8C%E5%85%B3%E9%97%AD%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.3.</span> <span class="toc-text">三  MySQL启动和关闭管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-MySQL%E5%90%AF%E5%8A%A8%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">1.MySQL启动的方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">2.错误日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%85%B3%E9%97%AD%E6%96%B9%E5%BC%8F"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">3.关闭方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.4.</span> <span class="toc-text">四  用户管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-MySQL%E7%94%A8%E6%88%B7%E5%AE%9A%E4%B9%89"><span class="toc-number">1.1.4.1.</span> <span class="toc-text">1.MySQL用户定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%9F%A5%E7%9C%8B%E7%94%A8%E6%88%B7"><span class="toc-number">1.1.4.2.</span> <span class="toc-text">2.查看用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7"><span class="toc-number">1.1.4.3.</span> <span class="toc-text">3.创建用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81"><span class="toc-number">1.1.4.4.</span> <span class="toc-text">4.修改用户密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7"><span class="toc-number">1.1.4.5.</span> <span class="toc-text">5.删除用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81"><span class="toc-number">1.1.4.6.</span> <span class="toc-text">6.设置密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E6%89%BE%E5%9B%9Eroot%E5%AF%86%E7%A0%81"><span class="toc-number">1.1.4.7.</span> <span class="toc-text">7.找回root密码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94-%E7%99%BB%E5%BD%95%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.5.</span> <span class="toc-text">五 登录连接管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD-%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.6.</span> <span class="toc-text">六 配置管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="toc-number">1.1.6.1.</span> <span class="toc-text">1.配置文件说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AE%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">1.1.6.2.</span> <span class="toc-text">2.配置优先级</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">1.1.6.3.</span> <span class="toc-text">3.配置文件优先级</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BC%98%E5%85%88%E7%BA%A7%E5%AE%9E%E9%AA%8C"><span class="toc-number">1.1.6.4.</span> <span class="toc-text">4.优先级实验</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83-%E5%A4%9A%E5%AE%9E%E4%BE%8BMySQL"><span class="toc-number">1.1.7.</span> <span class="toc-text">七 多实例MySQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E5%8F%AB%E5%A4%9A%E5%AE%9E%E4%BE%8BMySQL"><span class="toc-number">1.1.7.1.</span> <span class="toc-text">1.什么叫多实例MySQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E5%A4%9A%E5%AE%9E%E4%BE%8BMySQL%E8%BF%9B%E7%A8%8B"><span class="toc-number">1.1.7.2.</span> <span class="toc-text">2.创建多实例MySQL进程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0-mysql-SQL%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.2.</span> <span class="toc-text">第2章 mysql-SQL语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-sql%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.1.</span> <span class="toc-text">一 sql介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E5%8F%ABSQL%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">1.什么叫SQL语句?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-SQL%E7%9A%84%E5%88%86%E7%B1%BB-DDL%E3%80%81DCL%E3%80%81DML%E3%80%81DQL"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">2.SQL的分类-DDL、DCL、DML、DQL</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E8%B1%A1%E5%B1%9E%E6%80%A7%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.2.2.</span> <span class="toc-text">二 数据库对象属性介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AD%97%E7%AC%A6%E9%9B%86"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">1.字符集</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%88%97%E5%B1%9E%E6%80%A7"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">2.列属性</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E6%95%B0%E5%AD%97%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.2.2.1.</span> <span class="toc-text">2.1 数字类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.2.2.2.</span> <span class="toc-text">2.2 字段类型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.2.2.2.3.</span> <span class="toc-text">2.3 时间类型</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%88%97%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">3.列约束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%85%B6%E4%BB%96%E5%B1%9E%E6%80%A7"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">4.其他属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%8E%BB%E5%85%AC%E5%8F%B8%E5%A6%82%E4%BD%95%E7%86%9F%E6%82%89%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%9A%E5%8A%A1"><span class="toc-number">1.2.2.5.</span> <span class="toc-text">3. 去公司如何熟悉数据库业务?</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-DDL%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%9A%E4%B9%89%E8%AF%AD%E2%BE%94"><span class="toc-number">1.2.3.</span> <span class="toc-text">三 DDL数据库定义语⾔</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%BA%93%E5%AE%9A%E4%B9%89"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">1.库定义</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-%E5%BB%BA%E8%A1%A8%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.2.3.1.1.</span> <span class="toc-text">1.1 建表语句</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-2-%E5%88%9B%E5%BB%BA%E5%BA%93"><span class="toc-number">1.2.3.1.1.1.</span> <span class="toc-text">1.2 创建库</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#1-3-%E4%BF%AE%E6%94%B9%E5%BA%93"><span class="toc-number">1.2.3.1.1.2.</span> <span class="toc-text">1.3 修改库</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#1-4-%E6%9F%A5%E7%9C%8B%E5%BA%93"><span class="toc-number">1.2.3.1.1.3.</span> <span class="toc-text">1.4 查看库</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#1-5-%E5%88%A0%E9%99%A4%E5%BA%93"><span class="toc-number">1.2.3.1.1.4.</span> <span class="toc-text">1.5 删除库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%A1%A8%E5%AE%9A%E4%B9%89"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">2.表定义</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E8%A1%A8%E5%AE%9A%E4%B9%89%E8%A7%84%E8%8C%83"><span class="toc-number">1.2.3.2.1.</span> <span class="toc-text">2.1 表定义规范</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">1.2.3.2.2.</span> <span class="toc-text">2.2 创建表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-%E6%9F%A5%E7%9C%8B%E8%A1%A8%E5%92%8C%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.3.2.3.</span> <span class="toc-text">2.3 查看表和表结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-%E5%A4%8D%E5%88%B6%E2%BC%80%E5%BC%A0%E8%A1%A8"><span class="toc-number">1.2.3.2.4.</span> <span class="toc-text">2.4 复制⼀张表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-5-%E4%BF%AE%E6%94%B9%E8%A1%A8%E5%AE%9A%E4%B9%89"><span class="toc-number">1.2.3.2.5.</span> <span class="toc-text">2.5 修改表定义</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-6-%E4%BF%AE%E6%94%B9%E8%A1%A8%E5%B1%9E%E6%80%A7"><span class="toc-number">1.2.3.2.6.</span> <span class="toc-text">2.6 修改表属性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-7-%E4%BF%AE%E6%94%B9%E5%88%97%E5%B1%9E%E6%80%A7"><span class="toc-number">1.2.3.2.7.</span> <span class="toc-text">2.7 修改列属性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-8-%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-number">1.2.3.2.8.</span> <span class="toc-text">2.8 删除表</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B-DCL-%E6%95%B0%E6%8D%AE%E6%8E%A7%E5%88%B6%E8%AF%AD%E8%A8%80"><span class="toc-number">1.2.4.</span> <span class="toc-text">四 DCL 数据控制语言</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AF%E5%88%A9%E7%94%A8-DCL-%E6%8E%A7%E5%88%B6%E7%9A%84%E6%9D%83%E9%99%90"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">可利用 DCL 控制的权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">语法结构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94-DML-%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E8%AF%AD%E2%BE%94"><span class="toc-number">1.2.5.</span> <span class="toc-text">五 DML 数据操作语⾔</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-INSERT-%E6%8F%92%E2%BC%8A%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">1.INSERT 插⼊表数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-UPDATE-%E4%BF%AE%E6%94%B9%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.5.2.</span> <span class="toc-text">2.UPDATE 修改表数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-DELETE-UPDATE-TRUNCATE-%E5%88%A0%E9%99%A4%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.5.3.</span> <span class="toc-text">3.DELETE&#x2F;UPDATE&#x2F;TRUNCATE 删除表数据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-DELETE"><span class="toc-number">1.2.5.3.1.</span> <span class="toc-text">3.1 DELETE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-%E4%BC%AA%E5%88%A0%E9%99%A4"><span class="toc-number">1.2.5.3.2.</span> <span class="toc-text">3.2 伪删除</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E2%BE%AF%E8%AF%95%E9%A2%98"><span class="toc-number">1.2.5.4.</span> <span class="toc-text">4.⾯试题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD-DQL%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E2%BE%94"><span class="toc-number">1.2.6.</span> <span class="toc-text">六 DQL数据查询语⾔</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-SQL%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5-SELECT"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">1. SQL查询语句-SELECT</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-SELECT-%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.2.6.1.1.</span> <span class="toc-text">1.1 SELECT 语句</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-WHERE-%E5%AD%90%E5%8F%A5"><span class="toc-number">1.2.6.1.2.</span> <span class="toc-text">1.2 WHERE 子句</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%B8%BE%E4%BE%8B"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">2.举例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-GROUP-BY-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">1.2.6.3.</span> <span class="toc-text">3. GROUP BY 聚合函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-%E4%BB%80%E4%B9%88%E6%98%AFGROUP-BY"><span class="toc-number">1.2.6.3.1.</span> <span class="toc-text">3.1 什么是GROUP BY?</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%E9%83%BD%E6%9C%89%E5%93%AA%E4%BA%9B"><span class="toc-number">1.2.6.3.2.</span> <span class="toc-text">3.2 聚合函数都有哪些</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-group-by-%E5%88%86%E7%BB%84%E5%8A%9F%E8%83%BD%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.6.3.3.</span> <span class="toc-text">3.3 group by 分组功能原理</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-ORDER-BY-%E8%81%9A%E5%90%88%E6%8E%92%E5%BA%8F"><span class="toc-number">1.2.6.4.</span> <span class="toc-text">4 ORDER BY 聚合排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-HAVING-%E8%81%9A%E5%90%88%E5%88%A4%E6%96%AD"><span class="toc-number">1.2.6.5.</span> <span class="toc-text">5 HAVING 聚合判断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-LIMIT-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.6.6.</span> <span class="toc-text">6 LIMIT 分页查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E2%BC%A6%E5%8F%A5%E6%89%A7%E2%BE%8F%E9%A1%BA%E5%BA%8F"><span class="toc-number">1.2.6.7.</span> <span class="toc-text">7.⼦句执⾏顺序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E4%BA%BF%E7%82%B9%E7%82%B9%E7%BB%83%E4%B9%A0"><span class="toc-number">1.2.6.8.</span> <span class="toc-text">7 亿点点练习</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC3%E7%AB%A0-%E8%81%9A%E7%B0%87-%E5%8C%BA-%E7%B4%A2%E5%BC%95"><span class="toc-number">1.3.</span> <span class="toc-text">第3章 聚簇(区)索引</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%B4%A2%E5%BC%95%E7%90%86%E8%AE%BA"><span class="toc-number">1.3.1.</span> <span class="toc-text">1.索引理论</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E5%8F%AB%E7%B4%A2%E5%BC%95"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">1.1 什么叫索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E5%B9%B3%E8%A1%A1%E6%A0%91"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">1.2 平衡树</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E5%89%8D%E6%8F%90"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">1.3 前提</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.1.4.</span> <span class="toc-text">1.4 构建过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.3.1.5.</span> <span class="toc-text">1.5 查询语句</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%BE%85%E5%8A%A9%E7%B4%A2%E5%BC%95"><span class="toc-number">1.3.2.</span> <span class="toc-text">2 辅助索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%B4%A2%E5%BC%95%E5%BA%94%E7%94%A8"><span class="toc-number">1.3.3.</span> <span class="toc-text">3. 索引应用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%8E%8B%E6%B5%8B"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">3.1 压测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">3.2 查看索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E5%88%9B%E5%BB%BA%E8%BE%85%E5%8A%A9%E7%B4%A2%E5%BC%95"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">3.3 创建辅助索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">1.3.3.4.</span> <span class="toc-text">3.4 删除索引</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E6%89%A7%E2%BE%8F%E8%AE%A1%E5%88%92%E8%8E%B7%E5%8F%96%E5%92%8C%E5%88%86%E6%9E%90"><span class="toc-number">1.3.4.</span> <span class="toc-text">4 执⾏计划获取和分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E5%91%BD%E4%BB%A4%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.3.4.1.</span> <span class="toc-text">4.1 命令介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E4%BB%80%E4%B9%88%E5%8F%AB%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="toc-number">1.3.4.2.</span> <span class="toc-text">4.2 什么叫执行计划</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">1.3.4.3.</span> <span class="toc-text">4.3 使用方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-%E6%89%A7%E2%BE%8F%E8%AE%A1%E5%88%92%E4%BF%A1%E6%81%AF%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.3.4.4.</span> <span class="toc-text">4.4 执⾏计划信息介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.4.5.</span> <span class="toc-text">4.5 索引类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-key-len"><span class="toc-number">1.3.5.</span> <span class="toc-text">5 key_len</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-key-len%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.3.5.1.</span> <span class="toc-text">5.1 key_len介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-key-len%E8%AE%A1%E7%AE%97"><span class="toc-number">1.3.5.2.</span> <span class="toc-text">5.2 key_len计算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-key-len%E6%B3%A8%E6%84%8F"><span class="toc-number">1.3.5.3.</span> <span class="toc-text">3.key_len注意</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E4%B8%8D%E8%B5%B0%E7%B4%A2%E5%BC%95%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">1.3.6.</span> <span class="toc-text">6 不走索引的情况</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%BB%BA%E7%AB%8B%E7%B4%A2%E5%BC%95%E7%9A%84%E5%8E%9F%E5%88%99"><span class="toc-number">1.3.7.</span> <span class="toc-text">7 建立索引的原则</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC4%E7%AB%A0-mysql%E6%97%A5%E5%BF%97"><span class="toc-number">1.4.</span> <span class="toc-text">第4章  mysql日志</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E9%94%99%E8%AF%AF%E6%97%A5%E5%BF%97"><span class="toc-number">1.4.1.</span> <span class="toc-text">一 错误日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%97%A5%E5%BF%97%E4%BD%9C%E7%94%A8"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">1.日志作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%BB%98%E8%AE%A4%E4%BD%8D%E7%BD%AE"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">2.默认位置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%8F%82%E6%95%B0"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">3.配置文件参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%9D%91"><span class="toc-number">1.4.1.4.</span> <span class="toc-text">4.坑</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-%E6%85%A2%E6%97%A5%E5%BF%97"><span class="toc-number">1.4.2.</span> <span class="toc-text">二 慢日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%85%A2%E6%97%A5%E5%BF%97%E4%BD%9C%E7%94%A8"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">1.慢日志作用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">2.修改配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E6%A8%A1%E6%8B%9F%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">3.模拟语句</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-binlog%E6%97%A5%E5%BF%97"><span class="toc-number">1.4.3.</span> <span class="toc-text">三 binlog日志</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-binlog%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">1. binlog介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AFbinlog%E6%97%A5%E5%BF%97"><span class="toc-number">1.4.3.1.1.</span> <span class="toc-text">1.1 什么是binlog日志</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81binlog%E6%97%A5%E5%BF%97"><span class="toc-number">1.4.3.1.2.</span> <span class="toc-text">1.2 为什么需要binlog日志</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#1-3-binlog%E4%B8%89%E7%A7%8D%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.3.1.3.</span> <span class="toc-text">1.3 binlog三种模式</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-binlog%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">2. binlog配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-binlog%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">3. binlog命令使用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E4%BD%8D%E4%BA%8E%E5%93%AA%E4%B8%AAbinlog"><span class="toc-number">1.4.3.3.1.</span> <span class="toc-text">3.1 查看当前位于哪个binlog</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E7%9A%84%E4%BA%8B%E4%BB%B6"><span class="toc-number">1.4.3.3.2.</span> <span class="toc-text">3.2 查看当前的事件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3-%E5%88%B7%E6%96%B0%E6%97%A5%E5%BF%97"><span class="toc-number">1.4.3.3.3.</span> <span class="toc-text">3.3 刷新日志</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4-%E6%9F%A5%E7%9C%8B%E8%A7%A3%E5%AF%86%E5%90%8E%E7%9A%84binlog%E6%97%A5%E5%BF%97"><span class="toc-number">1.4.3.3.4.</span> <span class="toc-text">3.4 查看解密后的binlog日志</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-5-%E6%9F%A5%E7%9C%8Bbinlog%E6%97%A5%E5%BF%97"><span class="toc-number">1.4.3.3.5.</span> <span class="toc-text">3.5 查看binlog日志</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-6-binlog%E4%B8%B4%E6%97%B6%E5%85%B3%E9%97%AD%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.3.3.6.</span> <span class="toc-text">3.6 binlog临时关闭方法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%A8%A1%E6%8B%9F%E8%AF%AF%E5%88%A0%E9%99%A4%E6%81%A2%E5%A4%8D"><span class="toc-number">1.4.3.4.</span> <span class="toc-text">4 模拟误删除恢复</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.4.3.4.1.</span> <span class="toc-text">环境准备</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E6%80%9D%E8%B7%AF"><span class="toc-number">1.4.3.4.2.</span> <span class="toc-text">恢复思路</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.4.3.4.3.</span> <span class="toc-text">恢复步骤</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E5%A4%8D%E6%9D%82%E6%83%85%E5%86%B5%E4%B8%8B%E6%81%A2%E5%A4%8D%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.3.5.</span> <span class="toc-text">5 复杂情况下恢复方法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.3.5.1.</span> <span class="toc-text">5.1方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-2%E8%B7%A8%E5%A4%9A%E4%B8%AAbinlog%E4%BD%BF%E7%94%A8%E6%97%B6%E9%97%B4%E6%81%A2%E5%A4%8D"><span class="toc-number">1.4.3.5.2.</span> <span class="toc-text">5.2跨多个binlog使用时间恢复</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-d-%E5%BA%93%E5%90%8D-%E5%8F%AA%E5%AF%BC%E5%87%BA%E6%9F%90%E4%B8%AA%E5%BA%93%E7%9A%84binlog%E4%BA%8B%E4%BB%B6"><span class="toc-number">1.4.3.5.3.</span> <span class="toc-text">5.3   -d 库名  只导出某个库的binlog事件</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%9F%BA%E4%BA%8EGTID%E7%9A%84binlog%E5%BA%94%E7%94%A8"><span class="toc-number">1.4.3.6.</span> <span class="toc-text">6 基于GTID的binlog应用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-1-GTID"><span class="toc-number">1.4.3.6.1.</span> <span class="toc-text">6.1 GTID</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-2-%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.4.3.6.2.</span> <span class="toc-text">6.2 事务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-3-%E6%9F%A5%E7%9C%8BGTID"><span class="toc-number">1.4.3.6.3.</span> <span class="toc-text">6.3 查看GTID</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-4-%E9%85%8D%E7%BD%AE%E5%BC%80%E5%90%AFGTID%E5%8A%9F%E8%83%BD"><span class="toc-number">1.4.3.6.4.</span> <span class="toc-text">6.4 配置开启GTID功能</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-5-GITD%E6%A8%A1%E5%BC%8F%E6%88%AA%E5%8F%96binlog"><span class="toc-number">1.4.3.6.5.</span> <span class="toc-text">6.5 GITD模式截取binlog</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-binlog%E6%97%A5%E5%BF%97%E6%B8%85%E7%90%86"><span class="toc-number">1.4.3.7.</span> <span class="toc-text">7 binlog日志清理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#7-1%E6%89%8B%E5%8A%A8%E5%88%B7%E6%96%B0"><span class="toc-number">1.4.3.7.1.</span> <span class="toc-text">7.1手动刷新</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-2-%E9%BB%98%E8%AE%A4%E5%A4%A7%E5%B0%8F"><span class="toc-number">1.4.3.7.2.</span> <span class="toc-text">7.2 默认大小</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-3-%E6%97%A5%E5%BF%97%E5%88%A0%E9%99%A4"><span class="toc-number">1.4.3.7.3.</span> <span class="toc-text">7.3 日志删除</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC5%E7%AB%A0-MySQL%E5%A4%87%E4%BB%BD%E6%81%A2%E5%A4%8D"><span class="toc-number">1.5.</span> <span class="toc-text">第5章 MySQL备份恢复</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E5%A4%87%E4%BB%BD%E7%90%86%E8%AE%BA"><span class="toc-number">1.5.1.</span> <span class="toc-text">一 备份理论</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-MySQL%E5%A4%87%E4%BB%BD%E6%96%B9%E5%BC%8F"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">1.MySQL备份方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%80%BB%E8%BE%91%E5%A4%87%E4%BB%BD%E5%92%8C%E7%89%A9%E7%90%86%E5%A4%87%E4%BB%BD%E5%8C%BA%E5%88%AB"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">2.逻辑备份和物理备份区别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-mysqldump%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.2.</span> <span class="toc-text">二 mysqldump工具使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">1.介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%8F%82%E6%95%B0"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">2.参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%A4%87%E4%BB%BD%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.2.3.</span> <span class="toc-text">3 备份命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-1%E5%85%A8%E5%A4%87%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.2.3.1.</span> <span class="toc-text">3.1全备命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2%E5%A4%87%E4%BB%BD%E5%8D%95%E4%B8%AA%E5%BA%93%E6%88%96%E5%A4%9A%E4%B8%AA%E5%BA%93"><span class="toc-number">1.5.2.3.2.</span> <span class="toc-text">3.2备份单个库或多个库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3%E5%A4%87%E4%BB%BD%E5%8D%95%E4%B8%AA%E8%A1%A8%E6%88%96%E5%A4%9A%E4%B8%AA%E8%A1%A8"><span class="toc-number">1.5.2.3.3.</span> <span class="toc-text">3.3备份单个表或多个表</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-4%E8%BF%9C%E7%A8%8B%E5%A4%87%E4%BB%BD"><span class="toc-number">1.5.2.3.4.</span> <span class="toc-text">3.4远程备份</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-mysqldump%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E5%A4%87%E4%BB%BD%E8%84%9A%E6%9C%AC"><span class="toc-number">1.5.2.4.</span> <span class="toc-text">4 mysqldump分库分表备份脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1%E6%80%9D%E8%B7%AF"><span class="toc-number">1.5.2.4.1.</span> <span class="toc-text">4.1思路</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2%E8%84%9A%E6%9C%AC"><span class="toc-number">1.5.2.4.2.</span> <span class="toc-text">4.2脚本</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-3%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B8%A6%E5%AF%86%E7%A0%81%E8%AD%A6%E5%91%8A%EF%BC%8C%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95"><span class="toc-number">1.5.2.4.3.</span> <span class="toc-text">4.3命令行带密码警告，解决方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-Xtrabackup"><span class="toc-number">1.5.3.</span> <span class="toc-text">三 Xtrabackup</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-Xtrabackup%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.5.3.0.1.</span> <span class="toc-text">1.Xtrabackup介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-Xtrabackup%E5%AE%89%E8%A3%85"><span class="toc-number">1.5.3.0.2.</span> <span class="toc-text">2.Xtrabackup安装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-Xtrabackup%E5%85%A8%E5%A4%87%E6%95%B0%E6%8D%AE"><span class="toc-number">1.5.3.0.3.</span> <span class="toc-text">3. Xtrabackup全备数据</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#3-1%E5%85%A8%E9%87%8F%E5%A4%87%E4%BB%BD%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.3.0.3.1.</span> <span class="toc-text">3.1全量备份命令</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2%E7%9B%B8%E5%85%B3%E6%96%87%E4%BB%B6"><span class="toc-number">1.5.3.0.4.</span> <span class="toc-text">3.2相关文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-3%E6%81%A2%E5%A4%8D%E5%91%BD%E4%BB%A4"><span class="toc-number">1.5.3.0.5.</span> <span class="toc-text">3.3恢复命令</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-Xtrabackup%E5%A2%9E%E9%87%8F%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">4 Xtrabackup增量备份数据</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.5.3.1.1.</span> <span class="toc-text">4.1介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2%E5%AE%9E%E9%AA%8C%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.5.3.1.2.</span> <span class="toc-text">4.2实验步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">1.5.3.1.2.1.</span> <span class="toc-text">实验环境</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E6%AD%A5%E9%AA%A4-1"><span class="toc-number">1.5.3.1.2.2.</span> <span class="toc-text">恢复步骤</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC6%E7%AB%A0-MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">1.6.</span> <span class="toc-text">第6章 MySQL主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%B5%81%E7%A8%8B%E5%8E%9F%E7%90%86"><span class="toc-number">1.6.1.</span> <span class="toc-text">一 主从复制流程原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E9%83%A8%E7%BD%B2"><span class="toc-number">1.6.2.</span> <span class="toc-text">二 MySQL主从复制部署</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%B8%BB%E5%BA%93%E7%8E%AF%E5%A2%83"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">1.主库环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BB%8E%E5%BA%93%E7%8E%AF%E5%A2%83"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">2.从库环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.6.2.3.</span> <span class="toc-text">3 MySQL主从复制配置步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E6%95%85%E9%9A%9C"><span class="toc-number">1.6.2.4.</span> <span class="toc-text">4.主从复制故障</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#4-1-IO%E7%BA%BF%E7%A8%8B%E6%95%85%E9%9A%9C"><span class="toc-number">1.6.2.4.1.</span> <span class="toc-text">4.1 IO线程故障</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-2-SQL%E7%BA%BF%E7%A8%8B%E6%95%85%E9%9A%9C"><span class="toc-number">1.6.2.4.2.</span> <span class="toc-text">4.2 SQL线程故障</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/4a17b156.html" title="Hello World"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/posts/4a17b156.html" title="Hello World">Hello World</a><time datetime="2022-09-25T09:32:25.848Z" title="发表于 2022-09-25 09:32:25">2022-09-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/439fff01.html" title="Hello Worldsdasdas"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello Worldsdasdas"/></a><div class="content"><a class="title" href="/posts/439fff01.html" title="Hello Worldsdasdas">Hello Worldsdasdas</a><time datetime="2022-09-25T09:32:25.848Z" title="发表于 2022-09-25 09:32:25">2022-09-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/9520183a.html" title="mysql"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="mysql"/></a><div class="content"><a class="title" href="/posts/9520183a.html" title="mysql">mysql</a><time datetime="2021-09-01T00:00:00.000Z" title="发表于 2021-09-01 00:00:00">2021-09-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/d87f7e0c.html" title="test"><img src="https://typora-1257900361.cos.ap-guangzhou.myqcloud.com/images/image-20220921160816077.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="test"/></a><div class="content"><a class="title" href="/posts/d87f7e0c.html" title="test">test</a><time datetime="2018-09-01T00:00:00.000Z" title="发表于 2018-09-01 00:00:00">2018-09-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By John Doe</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>